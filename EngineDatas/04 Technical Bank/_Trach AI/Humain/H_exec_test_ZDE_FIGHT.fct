#include "H_defines.var"

int				ti_nb_obj
int				ti_flag_hit
int				ti_type_paf
float				ti_force_paf
int				ti_canal

object		to_obj
object		tao_obj[100]
object		to_gao

vector		tv_tir_depart
vector		tv_sight

int				ti_ok


if (i_flag_zde_fight_enable)
{
	ti_flag_hit = faux
	ti_nb_obj = COL_ZDE_ZDEListGet(&tao_obj[0], C_zde_fight, C_zde_corps, all, none, Ci_Filter_IdentityFlag)
	while (ti_nb_obj)
	{
		ti_nb_obj--
		
		to_obj = tao_obj[ti_nb_obj] 
	
		ti_ok = vrai
		if(to_obj == OBJ_Me()) ti_ok = faux
		if(@to_obj AI_IsModel("KingKong/Humain")) ti_ok = faux
		
		if (ti_ok) 
		{
			ti_flag_hit = vrai
//			if (H_OBJENMAIN_PARAM == 1)
			if( H_Weapon_IsOnFire() )
				ti_type_paf = C_PAF_KK_Moyen
			else
				ti_type_paf = C_PAF_KK_Repousse
			ti_force_paf = PAF_Unit
			if(TIME_Elapsed(f_time_last_coup, 0.4))
			{
				tv_sight = OBJ_SightGet()
				
				to_gao = COL_RayObject_Dist(OBJ_PosGet(), tv_sight, 5.0, all, none, Ci_Filter_IdentityFlag, COL_C_Ray_on_visuel_and_bone_volumes)
				if( to_gao && COL_RayObject_ActorGet() != OBJ_Me() )
					ti_canal = COL_RayObject_CanalGet()
				else
					ti_canal = -1
				
				EVENT_AddEventPafCanal(C_EVENT_FILTER_All, ti_type_paf, OBJ_Me(), Cf_EVENT_Duree_1Trame, to_obj, ti_canal, ti_force_paf, tv_sight, OBJ_PosGet())
				f_time_last_coup = TIME_Get()
			}
			
			break
		}
	}

	if (ti_flag_hit)
	{
		i_flag_zde_fight_enable	= faux
	}
}
