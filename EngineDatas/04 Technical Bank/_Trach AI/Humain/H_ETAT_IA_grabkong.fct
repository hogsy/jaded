#include "H_defines.var"

int			ti_i
int			ti_flag_help
int			ti_context

float		tf_dist
float		tf_liferatio

vector	tv_pos
vector	tv_head_pos
vector	tv_head_banking
vector	tv_dest_pos

object	to_raptor
object	to_module

// SORTIE ETAT ===================================================================
if (i_sort_etat)
{
	COL_UnCollidableDel(o_grab_actor)
	DYN_GravitySet(Cv_NormalGravity)	
	AI_CBDel(o_grab_actor, CallBack_After_Blend, "H_callback_set_pos")	
	i_sort_etat = faux
	return
}

// INITIALISATION ETAT ==============================================================
if (i_etat_courant != ETAT_IA_grabkong)
{
	i_dernier_etat = i_etat_courant
	i_etat_courant = ETAT_IA_grabkong

	if (fct_last_etat)
	{
		i_sort_etat = vrai
		AI_Execute(fct_last_etat)
	}

	fct_last_etat = AI_TrackCurGet()
	
	for (ti_i = 0; ti_i < Ci_LNK_TYPE_NB; ti_i++)
		ai_SRV_ENABLE[ti_i] = faux

	ai_SRV_ENABLE[Ci_LNK_KKGRAB_OBJECT] = vrai

	o_grab_actor = ao_SRV[Ci_LNK_KKGRAB_OBJECT] 
	AI_CBAdd(o_grab_actor, CallBack_After_Blend, "H_callback_set_pos")

	COL_UnCollidableAdd(o_grab_actor)

	DYN_SpeedSetVector( Cv_NullVector)
	DYN_TractionSet( Cv_NullVector)
	DYN_GravitySet(Cv_NullVector)	

	DYN_SpeedSetVector( Cv_NullVector)
	DYN_TractionSet( Cv_NullVector)
	
	ACT_ActionSet(Action_Grabed_raptor_bras)

	f_time_start_etat = 0.0
}
else
{
	f_time_start_etat += TIME_GetDt()
}

// ANALYSE  =====================================================================

if (!ao_SRV[Ci_LNK_KKGRAB_OBJECT] ) macro_change_etat("H_ETAT_IA_Projete")
AI_Execute("H_exec_serveur_get")

// COMPORTEMENT ===============================================================
AI_Execute("H_exec_read_world")