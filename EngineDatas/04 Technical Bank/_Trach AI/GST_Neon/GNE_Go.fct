Include_UltraProcedure_Header

if (!i_flag_paf)
{
	Proc_KongFight_TargetAdd(OBJ_Me(), OBJ_PosGet(), 3.0, C_AIDE_AU_TIR_Prio_Mur, 0)
	AI_Execute("GNE_Exec_CheckPaf")
}

// MALFUNCTION ==============================================================
if (Malfunction_every_min != -1)
{
	Malfunction_every_cur -= MATH_FloatMin(Malfunction_every_cur, TIME_GetDt())
	if (!Malfunction_every_cur)
	{
		if (i_flag_paf)
			i_neon_type_cur = 666
		else
		{
			i_neon_type_cur = 1
			Malfunction_Duration_cur -= MATH_FloatMin(Malfunction_Duration_cur, TIME_GetDt())
			if (!Malfunction_Duration_cur)
			{
				i_neon_type_cur = i_neon_type
				Malfunction_every_cur = MATH_RandFloat(Malfunction_every_min, Malfunction_every_max)

				if (Etincelle_Pos[0])
				{
					Etincelle_ID = MATH_Modulo(Etincelle_ID+1,5)
					if (!Etincelle_Pos[Etincelle_ID])
						Etincelle_ID = 0
				}
			}
		}
	}
	else
		Malfunction_Duration_cur = Malfunction_Duration
}
// MALFUNCTION ==============================================================

//if (IO_KeyJustPressed(65))
//{
//	i_flag_paf = vrai
//	i_neon_type_cur = 1
//	Malfunction_every_min = 0
//	Malfunction_every_cur = 0.2
//	Proc_GNE_SFXGlass(OBJ_PosGet(), -5.0, 50)
//	Proc_GNE_SFXGlass(OBJ_PosGet(), -8.0, 50)
//	Proc_GNE_SFXGlass(OBJ_PosGet(), -6.0, 20)
//	Proc_GNE_SFXEtincelle(@Etincelle_Pos[0] OBJ_PosGet(), -@Etincelle_Pos[0] OBJ_SightGet())
//	Proc_GNE_SFXEtincelle(@Etincelle_Pos[1] OBJ_PosGet(), -@Etincelle_Pos[1] OBJ_SightGet())
//}


if (i_neon_type_cur == 2)
{
	if (Blend_status)
	{
		// ON
		Blend_Intensity = MATH_FloatBlend(Blend_Intensity, 1.0, BlendOn_Speed * TIME_GetDt())
		Blend_Duration -= MATH_FloatMin(Blend_Duration, TIME_GetDt())
		if (!Blend_Duration)
		{
			Blend_status = 1-Blend_status
			Blend_Duration = MATH_RandFloat(BlendOff_Duration_Min,BlendOff_Duration_Max)
		}
	}
	else
	{
		// OFF
		Blend_Intensity = MATH_FloatBlend(Blend_Intensity, BlendOff_Intensity , BlendOff_Speed * TIME_GetDt())
		Blend_Duration -= MATH_FloatMin(Blend_Duration, TIME_GetDt())
		if (!Blend_Duration)
		{
			Blend_status = 1-Blend_status
			Blend_Duration = MATH_RandFloat(BlendOn_Duration_Min,BlendOn_Duration_Max)
		}

	}
}
