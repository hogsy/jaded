#include "KWC_Defines.var"

if ( TIME_Get() - mf_DigwazaiYellTimeStamp > mf_DelayAfterYellForAttack )
{
	int i_Index
	
	if ( mi_ImmediateAttackTargeting )
	{
		object o_Target
	
		o_Target = mm_Msg.msg_gao1
		
		OBJ_PosSet( @o_Target OBJ_PosGet() )
		
		if ( mi_UseStaticTargetting )
		{
			AI_Execute( "KWZ_SetKNGTarget_Exec.fct" )
		}
	}

	if ( mm_Msg.msg_gao1 == mo_ANN )
	{
		mi_NumberOfAttacksOnAnn++
		
		if ( mi_NumberOfAttacksOnAnn < mi_NumberOfAttacksOnAnnBeforeAccurate )
		{
			mm_Msg.msg_int2	= faux				// should shots be accurate
		}
		else
		{
			mm_Msg.msg_int2	= vrai					// should shots be accurate
		}
	}
	else
	{
		mm_Msg.msg_int2		= vrai					// should shots be accurate
	}
		
	mm_Msg.msg_int1			= vrai					// is active mode
	mi_CapaToSet				= OBJ_Capa_1
	
	//triggers:
	for ( i_Index = 0; i_Index < C_Max_TriggerExecs; i_Index++ )
	{
		// if there is a valid trigger, trigger it and
		if ( mt_TriggerExec[i_Index] && AI_TriggerIsValid( mt_TriggerExec[i_Index] ) )
		{
			call_trigger( mt_TriggerExec[i_Index] )
		}
	}

	AI_Execute( "KWC_Attack_Exec.fct" )
	
	mf_DigwazaiTimeStamp 	= TIME_Get()
	
	AI_TrackStop( C_Track_Active )
}