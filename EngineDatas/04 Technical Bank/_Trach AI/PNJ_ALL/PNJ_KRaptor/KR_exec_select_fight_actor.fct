#include "KR_defines.var"

//====================================================================================
// CHOIX DU FIGHT ACTOR : ANN OU KONG ?
//====================================================================================

messageid		tmid_vision

message		tm_filter

int					ti_whereIsAnn
int					ti_nbRaptorsOnAnn
int					ti_annAvailability

object			to_lockedFightActor
object			to_lastFA

vector			tv_annPos

float				tf_distToKongSqr
float				tf_distToAnnSqr


to_lastFA = o_fight_actor
o_fight_actor = nobody

if( i_etat_courant == ETAT_interact_ANN )
{
	i_etat_courant = ETAT_interact_ANN
}


//==========================
// manage locked target
//==========================
if (f_locked_FA_timer > 0.0)
{
	if (o_locked_FA == o_KONG)
	{
		if (KR_CanHaveFightActor_Kong())
			o_fight_actor = o_KONG
	}
	else if (o_ANN && o_locked_FA == o_ANN)
	{
		if (KR_CanHaveFightActor_Ann(0))	// 0 means no limit
			o_fight_actor = o_ANN
	}
	if (o_fight_actor != nobody)
		return
}



//==========================
// manage forced target
//==========================
if (o_force_target != nobody)
{
	if (o_ANN && o_force_target == o_ANN)
	{
		if (KR_CanHaveFightActor_Ann(0))	// 0 means no limit
			o_fight_actor = o_ANN
		else
			o_fight_actor = nobody
	}
	else if (o_force_target == o_KONG)
	{
		if (KR_CanHaveFightActor_Kong())
			o_fight_actor = o_KONG
		else
			o_fight_actor = nobody
	}
	return
}

//==================================
// if we were attacking ann, keep attacking her
//==================================
if (o_ANN && to_lastFA == o_ANN)
{
	if (KR_CanHaveFightActor_Ann(Ci_MAX_RAPTORS_FIGHTING_ANN))
		o_fight_actor = o_ANN
	else if (KR_CanHaveFightActor_Kong())
		o_fight_actor = o_KONG
	return
}

//==================================
// Choose between Kong and Ann :
//
// If kong far enough not to be a threat and
// Ann is close enough, attack Ann 
// otherwise attack Kong
//==================================
if (o_ANN && KR_CanHaveFightActor_Ann(Ci_MAX_RAPTORS_FIGHTING_ANN))
{
//	if (KR_CanHaveFightActor_Kong())
//	{
//		// can attack both
//		// if kong is a threat, attack him instead
//		tf_distToAnnSqr = OBJ_SqrDistHorz(o_ANN)
//		tf_distToKongSqr = OBJ_SqrDistHorz(o_KONG)
//
//		if (tf_distToKongSqr > (tf_distToAnnSqr + Cf_FA_DstKongOffsetToFavorAnnSqr))
//			o_fight_actor = o_ANN
//		else
//			o_fight_actor = o_KONG
//	}
//	else
		o_fight_actor = o_ANN
}
else
{
	if (KR_CanHaveFightActor_Kong())
		o_fight_actor = o_KONG
}

