#include "KR_defines.var"

int			ti_i

float		tf_coef
float		tf_targetPriority

vector	tv_speed
vector	tv_dest_pos


// GESTION DES FACES TRAVERSABLES EN MODE PROJECTILE ----------------------------------------------------
if (i_etat_courant != ETAT_projectile && i_etat_courant != ETAT_paf && (COL_CrossableGet() & Gmat_KK_Cross_All_But_Kong_And_Raptors))
{
	if (COL_GMatReportGet(Gmat_KK_Cross_All_But_Kong_And_Raptors) == -1)
		COL_CrossableSet( none, Gmat_KK_Cross_All_But_Kong_And_Raptors)
}

// Vitesse additionnelle des pafs
tv_speed = DYN_SpeedGetVector()
tv_speed += v_paf_add_speed
DYN_SpeedSetVector(tv_speed)
v_paf_add_speed = MATH_VecBlend(v_paf_add_speed, Cv_NullVector, 6.0 * TIME_GetDt()) 

KR_Soft_Collision()

switch(i_etat_courant)
{
	case ETAT_fight :
	case ETAT_paf :
	case ETAT_grab :
		@get_global i_ennemi_counter_new[Ci_ennemi_counter_in_fight]++
		break
	case ETAT_fight_KONG :
	case ETAT_fight_ANN :
		if( ! KK_i_fight_etat )
			@get_global i_ennemi_counter_new[Ci_ennemi_counter_waiting]++
		else
			@get_global i_ennemi_counter_new[Ci_ennemi_counter_in_fight]++
		break
	case ETAT_KK_ride :
		@get_global i_ennemi_counter_new[Ci_ennemi_counter_in_fight]++
		break
	case ETAT_attente :
		@get_global i_ennemi_counter_new[Ci_ennemi_counter_waiting]++
		break
	default:
		break
}


if( i_iam_a_kong_target )
{
	switch( i_etat_courant )
	{
		case ETAT_interact_ANN :
			tf_targetPriority = C_AIDE_AU_TIR_Prio_GrabAnn
			break
		case ETAT_fight_ANN :
			tf_targetPriority = C_AIDE_AU_TIR_Prio_AttackAnn
			break
		default:
			tf_targetPriority = C_AIDE_AU_TIR_Prio_Ennemi
			break
	}
	Proc_KongFight_TargetAdd(OBJ_Me(), COL_ZonePosGet(C_zde_corps), COL_ZoneSizeGet(C_zde_corps), tf_targetPriority, 0)
}

if( i_iam_a_kam_target )
{
	EVENT_AddEventLockCam(OBJ_Me(), C_EVENT_LockCamStatus_Fight, Cv_NullVector)
	KRDBG_DRAWSPHERE(Ci_DBG_DRAW_TMP,OBJ_PosGet(), 5.0, color_rouge)
}

// manage wait before next attack
f_wait_before_next_attack -= MATH_FloatMin(f_wait_before_next_attack, TIME_GetDt())

if( ! EVENT_LIFE_CurLifeGet(ID_LIFE) )
	f_time_before_desintegration -= MATH_FloatMin(f_time_before_desintegration, TIME_GetDt())

//ADDED SURESH
//KR_GFX_FootSteps() 


// SOUND RESPIRATION =========================================
switch( i_etat_courant )
{
	case ETAT_attente : 
	case ETAT_FollowNetwork :
	case ETAT_interact_ANN :
	case ETAT_fight_ANN :
	case ETAT_fight_KONG :
	case ETAT_KK_intimide :
		if( i_snd_respiration_loop == -1 )
			i_snd_respiration_loop = SND_RequestPlayLoop(Ci_SND_Respiration)
		break
		
	default:
		if( i_snd_respiration_loop != -1 )
		{
			SND_Destroy(i_snd_respiration_loop)
			i_snd_respiration_loop = -1
		}
		break
}

