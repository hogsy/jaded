#include "PNJ_antilope_defines.var"

int		ti_action

// SORTIE ETAT ===================================================================
if (i_sort_etat)
{
	i_sort_etat = faux
	DYN_TractionSet(Cv_NullVector)
	if ( i_etat_courant != ETAT_PA_THROWN)
		o_grabbed_actor_KK = LNK_ServeurGet(Ci_LNK_GRAB_KONG, mid_grabbed_by_Kong_LNK_ID, faux, nofunc, nofunc)
	COL_ColSetActivationSet(C_bit_zdm_pied, none)
	AI_CBDel(o_snap_actor, CallBack_After_Blend, "pa_CALLBACK_set_pos")
	DYN_GravitySet(Cv_NormalGravity)
	return

}

// INIT ETAT ======================================================================
if ( i_etat_courant != ETAT_PA_GRABBED)
{
	i_etat_courant = ETAT_PA_GRABBED
	
	if (fct_last_etat)
	{
		i_sort_etat = vrai
		AI_Execute(fct_last_etat)
	}
	fct_last_etat = AI_TrackCurGet()

	o_snap_actor = o_grabbed_actor_KK
	COL_ColSetActivationSet(none, C_bit_zdm_pied)
	AI_CBAdd(o_snap_actor, CallBack_After_Blend, "pa_CALLBACK_set_pos")

	v_grabbed_pos_init_blend = OBJ_PosGet()
	f_pos_blend_coef = 0.0
}
else
	f_pos_blend_coef = MATH_FloatMin( f_pos_blend_coef +  (4.0 * TIME_GetDt()), 1.0)



// REACTIONS ===============================================================


// TEST LIAISON GRAB ------------------------------------------------------------------------------------
o_grabbed_actor_KK = LNK_ServeurGet(Ci_LNK_GRAB_KONG, mid_grabbed_by_Kong_LNK_ID, vrai, nofunc, nofunc)
if ( ! o_grabbed_actor_KK)
{
	// il n'y a plus personne qui grabbe le raptor
	macro_change_etat("pa_ETAT_dead")		
}

ti_action = LNK_GrabKong_ActionGet( mid_grabbed_by_Kong_LNK_ID)
if ( ti_action == Ci_GrabKong_Lance )
{
	// il n'y a plus personne qui grabbe le raptor
	macro_change_etat("pa_ETAT_thrown")		
}


// COMPORTMEENT ===============================================================

if ( !MATH_FloatNullEpsilon( @o_grabbed_actor_KK DYN_SpeedGet() ))
	ACT_ActionSet( Action_KKHandGrabbedDead)
else
	ACT_ActionSet( Action_KKHandGrabbedDeadStop)