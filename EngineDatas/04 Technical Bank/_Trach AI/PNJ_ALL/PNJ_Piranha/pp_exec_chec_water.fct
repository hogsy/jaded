
float		tf_dist 
float		tf_dist_min
float		tf_z
vector	tv_dist
int			ti_rank
object	EVT_Pere
vector	EVT_Pos
messageid	EVT_Visibility_ID
vector	tv_pos
int			ti_profondeur_ok
int			ti_bouillonement

o_cadavre = nobody
o_target = nobody

// MORT
tf_dist_min = Cf_Infinit
ti_rank = -1
for (	EVT_Visibility_ID = MSG_GlobalScan(C_EVENT_TYPE_Cadavre, &ti_rank);
		MSG_GlobalIsValid(EVT_Visibility_ID);
		EVT_Visibility_ID = MSG_GlobalScan(C_EVENT_TYPE_Cadavre, &ti_rank))
{
	EVT_Pere = EVENT_PereGet(EVT_Visibility_ID)
	EVT_Pos = EVENT_PositionGet(EVT_Visibility_ID)
	if ( @o_BV_Territoire COL_BV_PointCollide( EVT_Pos) && IsInWater ( EVT_Pos, tf_z))
	{
		tv_dist = EVT_Pos - OBJ_PosGet()
		tv_dist.z = 0.0
		tf_dist = MATH_VecNorm(tv_dist)
		if ( tf_dist < tf_dist_min)
		{
			tf_dist_min = tf_dist
			o_cadavre = EVT_Pere
		}
	}
	
	// bouillonnement danger !
	if( o_cadavre )
	{
		tv_pos = @o_cadavre OBJ_PosGet()
		tv_pos.z = f_waterZ - 0.5
		tv_pos += cvector(MATH_RandFloat(-2.5,2.5),MATH_RandFloat(-2.5,2.5),MATH_RandFloat(-1,1))
		Piranha_GFX_Splash(tv_pos)	
	}
}


// VIVANT
if ( ! o_cadavre)
{
	tf_dist_min = Cf_Infinit
	ti_rank = -1
	for (	EVT_Visibility_ID = MSG_GlobalScan(C_EVENT_TYPE_Visibility, &ti_rank);
			MSG_GlobalIsValid(EVT_Visibility_ID);
			EVT_Visibility_ID = MSG_GlobalScan(C_EVENT_TYPE_Visibility, &ti_rank))
	{
		EVT_Pere = EVENT_PereGet(EVT_Visibility_ID)	
		// EVT_Pos = EVENT_PositionGet(EVT_Visibility_ID)
		// pas EVT_Pos car la position de Kong est modifiée !!!
		EVT_Pos = @EVT_Pere OBJ_PosGet()
		if ( @o_BV_Territoire COL_BV_PointCollide( EVT_Pos) && IsInWater ( EVT_Pos, tf_z))
		{
			// test profondeur
			if( EVT_Pere == AI_MainActorGet(C_ID_Kong) )
			{
				if( EVT_Pos.z < (f_waterZ - 2.0) )
					ti_profondeur_ok = vrai
				else
					ti_profondeur_ok = faux
			}
			else if( EVT_Pere == AI_MainActorGet(C_ID_Joueur) )
			{
				if( @get_Humain_path EVT_Pere i_flag_nage )
					ti_profondeur_ok = vrai
				else
					ti_profondeur_ok = faux
			}
			else
				ti_profondeur_ok = vrai
			
			// bouillonnement danger !
			tv_pos = EVT_Pos
			tv_pos.z = f_waterZ - 0.5
			tv_pos += cvector(MATH_RandFloat(-2.5,2.5),MATH_RandFloat(-2.5,2.5),MATH_RandFloat(-1,1))
			Piranha_GFX_Splash(tv_pos)
			
			// valide attaque ?
			if( ti_profondeur_ok )
			{
				tv_dist = EVT_Pos - OBJ_PosGet()
				tv_dist.z = 0.0
				tf_dist = MATH_VecNorm(tv_dist)
				if ( tf_dist < tf_dist_min)
				{
					tf_dist_min = tf_dist
					o_target = EVT_Pere
				}
			}
		}
	}
}

