#include "PNJ_Worm_defines.var"

float			tf_angle

f_delay_before_next_jump -= MATH_FloatMin(f_delay_before_next_jump, TIME_GetDt())
if (i_flag_dodge_shot_jump || !f_delay_before_next_jump)
{
	if ( ! i_flag_dodge_shot_jump )
	{
		tf_angle	= MATH_FloatSign(MATH_RandFloat(-1.0, 1.0)) * MATH_RandFloat(Cf_PiBy8, Cf_PiBy6)
	
		v_jump_dest_pos = OBJ_PosGet()
		v_jump_dest_pos += MATH_VecRotate(OBJ_SightGet(), Cv_VerticalVector, tf_angle) * MATH_RandFloat(1.0, 2.0)
	}
	
	if (GRID_LIB_IsReachableFrom(OBJ_PosGet(), v_jump_dest_pos, 0b0, 0.0, faux, 0))
	{
		v_jump_dest_pos.z += 2.0
		if (COL_RayObject_Dist(v_jump_dest_pos, -Cv_VerticalVector, 4.0, all, OBJ_C_IdentityFlag_Anims | OBJ_C_IdentityFlag_Dyna, Ci_Filter_IdentityFlag, COL_C_Ray_on_ColMap_NoCrossable))
		{
			v_jump_dest_pos = COL_RayObject_PosGet()
			
//			DBG_RenderVector(v_jump_dest_pos, Cv_VerticalVector * 5.0, color_blanc)	
	
			macro_change_etat("PNJ_Worm_ETAT_SAUT")
		}
	}
}