#include "PNJ_Worm_defines.var"

vector		tv_ground_normale

// PONDERATION ===================================================================
AI_Execute("PNJ_Worm_exec_set_ponderation")

// DYN ===========================================================================
if (OBJ_FlagsIdentityTest(OBJ_C_IdentityFlag_Dyna))
{
	DYN_FlagsSet(DYN_C_OptimizeColDisable, none)
	DYN_TractionSet(Cv_NullVector)
}

// ANALYSE =======================================================================
//i_flag_audio_check_done			= faux
i_flag_visual_check_done			= faux
i_flag_paf_check_done				= faux
//i_flag_collision_check_done		= faux
i_flag_shoot_check_done			= faux
//i_flag_budies_check_done			= faux
//i_flag_vala_check_done				= faux
//i_flag_check_best_interet_done	= faux

// ACTION ========================================================================
i_flag_dont_change_action = faux

// JUMP ==========================================================================
i_flag_dodge_shot_jump = faux

// COLLISION ======================================================================
if (COL_CollideType(COL_C_Ground))
{
	f_delay_until_last_ground_col = 0.0
	
	tv_ground_normale = COL_ZonePosGet(C_zdm_pied)
	tv_ground_normale -= COL_CollidedPointGet(COL_C_Ground)
	
	MATH_VecSetNormalize(tv_ground_normale)
	
	if (tv_ground_normale.z < 0.0)
		tv_ground_normale*= -1.0
		
	v_ground_normale = tv_ground_normale
//	v_ground_normale = MATH_VecBlendRotate(v_ground_normale, tv_ground_normale, 6.0 * TIME_GetDt())
}
else
{
	f_delay_until_last_ground_col += TIME_GetDt()
	
	if (f_delay_until_last_ground_col > 0.2)
		v_ground_normale = MATH_VecBlendRotate(v_ground_normale, Cv_VerticalVector, 4.0 * TIME_GetDt())
}

// MAIN ACTOR ====================================================================
o_main_actor = AI_MainActorGet(C_ID_Joueur)

// BUDIES ========================================================================
i_budy_nb = 0

// PERCEIVED =====================================================================
i_perceived_actor_nb					= 0

i_perceived_main_actor_index		= -1
i_perceived_best_actor_index			= -1

// SCREEN VISIBILITY ===============================================================
if (f_on_screen_pourcent > 0.5)
	f_on_screen_duration += TIME_GetDt()
else
	f_on_screen_duration = 0.0

// EVENT VISIBILITY =================================================================
mid_visibility = EVENT_AddEventVision
(
	C_ID_Scorpion,
	C_EVENT_FILTER_Enemy, 
	OBJ_Me(), 
	Cf_EVENT_Duree_1Trame, 
	OBJ_PosGet() + cvector( 0, 0, 1),
	C_EVENT_Visibility_Full_Mvt, 
	0.4, 
	100.0, 
	C_EVENT_CONTEXT_STANDARD, 
	2,
	1.0
)
