#include "PNJ_Tank_defines.var"

Include_UltraProcedure_Header

int			ti_alternate_cam
object	to_hotspot, to_canal
object	to_item 

o_main_actor = AI_MainActorGet(C_ID_Kong)
f_me_to_main_dist = OBJ_SqrDist(o_main_actor)


// ===============================================================================
// Cam Alternative

ti_alternate_cam = faux
if (i_flag_paf )
	ti_alternate_cam = vrai
else
{
	to_hotspot = @o_main_actor Proc_KK_HotSpotFightGet()
	if (to_hotspot == OBJ_Me() && @o_main_actor Proc_KK_JumpStatusGet() == Ci_KK_JumpStatus_Jumping )
		ti_alternate_cam = vrai
}

if (ti_alternate_cam)
	OBJ_CapaSet(OBJ_Capa_9,none)
else
	OBJ_CapaSet(none, OBJ_Capa_9)
// ===============================================================================


if ( o_BV_Shoot_force && @o_BV_Shoot_force COL_BV_PivotCollide( o_main_actor))
{
	if ( @o_main_actor Proc_KK_Test_Mode( ETAT_Kong_depl_souche))
	{
		to_canal = @o_main_actor ANI_CanalObjectGet( Anim_Canal_Torse)
		PNJ_Tank_GFX_GunsImpact( @to_canal OBJ_PosGet(), -OBJ_SightGet(), o_main_actor, 0, 0 , 0, @"PNJ_Pacifique/PNJ_Car_Manager" o_car_manager f_car_ground_Z)
		EVENT_AddEventPaf(C_EVENT_FILTER_All, (C_PAF_KK_Fort | C_PAF_KK_NON_DODGEABLE), OBJ_Me(), Cf_EVENT_Duree_1Trame, o_main_actor, 0.0 * PAF_Unit, MATH_VecNormalize(@o_main_actor OBJ_PosGet() - OBJ_PosGet()))

		SND_RequestPlay(Ci_Snd_Tank_Shoot)
		// TEXT "FEU !!!" ====================
		SPEECH_RequestPost
		(
			OBJ_Me(),
			OBJ_Me(), 
			SPEECH_CteTxg_SpeNewYork, 
			GeneNY_C_tank_shoot, 
			1.0, 
			SPEECH_Cte_PriorityDefault, 
			5,
			0,
			0,
			0
		)
		// TEXT "FEU !!!" ====================
	
		to_item = @o_main_actor Proc_KK_Souche()
		if ( to_item && ( @to_item AI_IsModel( get_PNJ_Car_Path) || @to_item AI_IsModel( get_PNJ_Tank_Path)))
		{
			@to_item OBJ_CapaSet( OBJ_Capa_10, none)
		}
	}	
}