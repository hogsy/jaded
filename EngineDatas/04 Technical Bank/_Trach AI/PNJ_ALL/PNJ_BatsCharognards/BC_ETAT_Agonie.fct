#include "BC_defines.var"


// SORTIE ETAT
if (i_sort_etat)
{
	i_sort_etat = faux
	return
}

// ENTREE ETAT
if (i_etat_courant != ETAT_Agonie)
{
	i_etat_ancien_ancien = i_etat_ancien
	i_etat_ancien = i_etat_courant
	i_etat_courant = ETAT_Agonie
	if (fct_last_etat)
	{
		i_sort_etat = vrai
		AI_Execute(fct_last_etat)
	}
	fct_last_etat = AI_TrackCurGet()
	f_time_start_etat = 0.0
	BC_DBG_Trace_Etat("etat agonie")
	
	i_flag_agonie = vrai
	
	BC_Degats(0.0, Cf_Life_Agonisant)		// force les points de vie pour l'agonie
	BC_action_frequency_set(1.0)
	
	if( ! BC_Boss() )
	{
//		if( f_time_agonie < Cf_duree_agonie )
//		{
//			ACT_ActionSet(ACTION_Agonie)
//		}
		AI_Execute("BC_exec_dyn_on")
	}
}
else
{
	f_time_agonie += TIME_GetDt()
	f_time_start_etat += TIME_GetDt()
}


if( BC_Collide_Ground() )
	DYN_Off()			// Dyna active jusqu'à ce que la bat touche le sol

i_flag_neck = faux

// COMPORTEMENT =====================================================================
macro_change_etat("BC_ETAT_Mort")

//if( ACT_ActionGet() == ACTION_Agonie || BC_Boss() )
//{
//	if( f_sum_pafs_force )
//		ACT_ActionSet(ACTION_Paf_Sol_Agonie)
//	else if( f_HP == 0.0 || f_time_agonie >= Cf_duree_agonie || i_flag_silent_kill )
//		macro_change_etat("BC_ETAT_Mort")
//}
//else if( ACT_ActionGet() == ACTION_Paf_Sol_Agonie )
//{
//	if( ACT_ActionFinished() )
//		ACT_ActionSet(ACTION_Agonie)
//}


//if( ! MATH_VecNullEpsilon(v_ground_normale) )
//	tv_inclinaison = v_ground_normale
//else
//	tv_inclinaison = Cv_VerticalVector
//OBJ_BankingSet(MATH_VecBlendRotate(OBJ_BankingGet(), tv_inclinaison, 10.0 * TIME_GetDt()))
