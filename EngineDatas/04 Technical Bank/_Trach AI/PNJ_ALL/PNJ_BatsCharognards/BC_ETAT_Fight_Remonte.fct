#include "BC_defines.var"

messageid		tmid_vision


// SORTIE ETAT =========================================================================
if (i_sort_etat)
{	
	i_sort_etat = faux
	return
}

// ENTREE ETAT =========================================================================
if (i_etat_courant != ETAT_Fight_Remonte)
{
	i_etat_ancien_ancien = i_etat_ancien
	i_etat_ancien = i_etat_courant
	i_etat_courant = ETAT_Fight_Remonte
	if (fct_last_etat)
	{
		i_sort_etat = vrai
		AI_Execute(fct_last_etat)
	}
	fct_last_etat = AI_TrackCurGet()
	f_time_start_etat = 0.0
	BC_DBG_Trace_Etat("etat fight remonte")
	
	// INIT DEPLACEMENT --------------------------------------------------------
	v_cible_pos = @o_boss_retreat_wp OBJ_PosGet()
	
	BC_ref_speed_set(f_vitesse_fight_remonte)
	ACT_ActionSet(i_ACTION_Vol_Standard)
	BC_action_frequency_set(2.0)
	
	i_flag_depl_horiz = faux
	
	OBJ_CapaSet(none, CAPA_Boss_attaque)
}
else
{
	f_time_start_etat += TIME_GetDt()
}

// EMERGENCY ABORT =============================
if( o_cible_attaque && ! BC_TargetActive(o_cible_attaque) )
{
	DBG_TraceObject(OBJ_Me())
	DBG_TraceString(" : EMERGENCY ABORT : Target non active (")
	DBG_TraceObject(o_cible_attaque)	
	DBG_TraceString(")")
	DBG_TraceEOL()	
	
	BC_Cadavre_Del(o_cible_attaque)
	o_cible_attaque = nobody
	AI_Execute("BC_exec_init_attente")
}


// ANALYSE =================================================================
i_flag_frein = faux
i_flag_neck = vrai
v_look_pos = @o_cible_attaque OBJ_PosGet()

BC_Interet_Update(mid_interet_attaque, C_EVENT_InteretStatusAttack, o_cible_attaque, tmid_vision)		// j'ai fini d'attendre

AI_Execute("BC_exec_MOVE_beziers")
if( i_flag_depl_fini && ! i_reseau_wp_count )
{
	@o_cible_attaque COL_UnCollidableDel(OBJ_Me())
//	f_boss_delai_aucune_attaque = 3.0		// MATH_RandFloat(3.0,6.0)
	AI_Execute("BC_exec_init_attente")		// retourne en ronde
}

