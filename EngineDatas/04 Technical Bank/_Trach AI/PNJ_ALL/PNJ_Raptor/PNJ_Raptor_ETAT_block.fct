#include "PNJ_Raptor_defines.var"

int			ti_i

object	to_head

// SORTIE ETAT ===================================================================
if (i_sort_etat)
{
	i_sort_etat = faux

	COL_UnCollidableDel(o_block_actor)
	
	o_block_actor = LNK_ClientGet(Ci_LNK_BLOCK_RAPTOR, mid_block_actor_LNK_ID, faux, nofunc, nofunc, nofunc)

	return
}

// INITIALISATION ETAT ==============================================================
if (i_etat_courant != ETAT_block)
{
	i_dernier_etat = i_etat_courant
	i_etat_courant = ETAT_block

	if (fct_last_etat)
	{
		i_sort_etat = vrai
		AI_Execute(fct_last_etat)
	}

	fct_last_etat = AI_TrackCurGet()

	ACT_ActionSet(Action_Fight_Block)

	COL_UnCollidableAdd(o_block_actor)

	f_time_start_etat = 0.0
}
else
{
	f_time_start_etat += TIME_GetDt()
}

// ANALYSE =======================================================================================================
AI_Execute("PNJ_Raptor_exec_check_sound")

AI_Execute("PNJ_Raptor_exec_check_collision")

AI_Execute("PNJ_Raptor_exec_check_vision")

AI_Execute("PNJ_Raptor_exec_check_shoot")

AI_Execute("PNJ_Raptor_exec_check_paf")
if ( i_flag_paf_important)
	macro_change_etat("PNJ_Raptor_ETAT_paf_important")
if (i_flag_paf_moyen)
	macro_change_etat("PNJ_Raptor_ETAT_paf_moyen")
//if (i_flag_paf_faible)
//	macro_change_etat("PNJ_Raptor_ETAT_paf_faible")

AI_Execute("PNJ_Raptor_exec_check_client")

if (o_backstaber && LNK_BACKSTAB_IsStarted(mid_backstab_LNK_ID))
	macro_change_etat("PNJ_Raptor_ETAT_paf_important")

AI_Execute("PNJ_Raptor_exec_check_vala")
if (MSG_GlobalIsValid(mid_vala))
	macro_change_etat("PNJ_Raptor_ETAT_vala")

if (o_block_actor == nobody || ! MSG_GlobalIsValid(mid_best_interet))
	macro_change_etat(fct_main_etat)

AI_Execute("PNJ_Raptor_exec_check_best_interest")

if (i_flag_change_target)
	macro_change_etat(fct_main_etat)

EVENT_InteretStatusSet(mid_best_interet, C_EVENT_InteretStatusLock)

// COMPORTEMENT =================================================================================================
ACT_ActionSet(Action_Fight_Block)

