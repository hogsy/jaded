#include "PNJ_Raptor_defines.var"

int			ti_i

int			ti_flag_dont_use_grid
int			ti_flag_stalk
int			ti_flag_alien_move

ti_flag_dont_use_grid = i_flag_dont_use_grid
ti_flag_stalk = i_flag_stalk
ti_flag_alien_move = i_flag_alien_move

// USE GRID OR DONT USE GRID ?
if (@o_next_wp OBJ_CapaTest(Ci_Capa_Out_Of_Grid))
	i_flag_dont_use_grid = vrai
else
	i_flag_dont_use_grid = faux

// USE OCCLUDER ?
if ( ! i_flag_dont_use_grid && @o_next_wp OBJ_CapaTest(Ci_Capa_Use_Occluder))
	i_flag_use_occluder = vrai
else
	i_flag_use_occluder = faux

// STALK OU PAS STALK ?
if (@o_next_wp OBJ_CapaTest(Ci_Capa_Stalk))
	i_flag_stalk = vrai
else
	i_flag_stalk = faux

// ALIEN MOVE OU PAS ?
if (@o_next_wp OBJ_CapaTest(Ci_Capa_Alien))
{
	i_flag_alien_move = vrai
	
	COL_ColSetActivationSet(none, C_bit_zdm_pied)
	DYN_GravitySet(Cv_NullVector)
}
else
{
	i_flag_alien_move = faux

	COL_StartMatrixSet(OBJ_PosGet())
	COL_ColSetActivationSet(C_bit_zdm_pied, none)

	DYN_GravitySet(v_jump_gravity)
}

#ifndef _FINAL_
if (DBG_Log_Allowed)
{
	if (!ti_flag_alien_move && i_flag_alien_move)
	{
		DBG_TraceFloat(TIME_Get())
		DBG_TraceString(" => ")
		DBG_TraceObject(OBJ_Me())
		DBG_TraceString(" PASSE EN MODE ALIEN")
		DBG_TraceEOL()
	}
	else if (ti_flag_alien_move && !i_flag_alien_move)
	{	
		DBG_TraceFloat(TIME_Get())
		DBG_TraceString(" => ")
		DBG_TraceObject(OBJ_Me())
		DBG_TraceString(" QUITTE LE MODE ALIEN")
		DBG_TraceEOL()
	}
	
	if (ti_flag_stalk && !i_flag_stalk)
	{
		DBG_TraceFloat(TIME_Get())
		DBG_TraceString(" => ")
		DBG_TraceObject(OBJ_Me())
		DBG_TraceString(" QUITTE LE STALK")
		DBG_TraceEOL()
	}
	else if (!ti_flag_stalk && i_flag_stalk)
	{
		DBG_TraceFloat(TIME_Get())
		DBG_TraceString(" => ")
		DBG_TraceObject(OBJ_Me())
		DBG_TraceString(" PASSE EN STALK")
		DBG_TraceEOL()
	}
}
#endif

if (!i_flag_stalk && i_flag_display_i_am_back)
{
	i_flag_display_i_am_back	= faux
	i_flag_outside_territory = faux

#ifndef _FINAL_	
	if (DBG_Display_Text)
		STR_CreateText("\h.07\LE MONSTRE REVIENT", cvector(0.35, 0.65, 0.0), 2.0)
#endif
	EVENT_AddEventInfo(OBJ_Me(), nobody, C_EVENT_INFOTYPE_BACK_ON_FIGHT)
}
else if (i_flag_stalk && i_flag_find_safe_pos)
{
	i_flag_outside_territory = vrai

#ifndef _FINAL_
	if (DBG_Display_Text)
		STR_CreateText("\h.07\LE MONSTRE FUIT", cvector(0.38, 0.65, 0.0), 2.0)	
#endif
}




