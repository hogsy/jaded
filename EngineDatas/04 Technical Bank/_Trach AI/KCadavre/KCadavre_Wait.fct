#include "KCadavre_defines.var"

message	tmsg_filter
messageid	tmid_paf_ID
object		to_pere
int				ti_type
int				ti_rank
float			tf_dmg

// DESTRUCTION ===================
if( f_points_de_viande == 0.0 )
	OBJ_Destroy()

// CHECK PAF =====================
if( f_points_de_viande != -1.0 )
{
	MSG_SetNull(tmsg_filter)
	tmsg_filter.msg_gao1 = OBJ_Me()
	ti_rank = -1
	for (	tmid_paf_ID = MSG_GlobalSearchIntGao(C_EVENT_TYPE_Paf, &ti_rank, tmsg_filter);
			MSG_GlobalIsValid(tmid_paf_ID);
			tmid_paf_ID = MSG_GlobalSearchIntGao(C_EVENT_TYPE_Paf, &ti_rank, tmsg_filter) ) {
		to_pere = EVENT_PereGet(tmid_paf_ID)
		ti_type = EVENT_PafTypeGet(tmid_paf_ID)
		tf_dmg = EVENT_PafPuisGet(tmid_paf_ID)
		if( ti_type & C_PAF_KK_FoodChain )
		{
			f_points_de_viande -= MATH_FloatMin(f_points_de_viande, tf_dmg)
		}
	}
}

// CADAVRE ======================
EVENT_AddEventCadavre(i_cadavre_ID, OBJ_Me(), Cf_EVENT_Duree_1Trame, OBJ_PosGet())

