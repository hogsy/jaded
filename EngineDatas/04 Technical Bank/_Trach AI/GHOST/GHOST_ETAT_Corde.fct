#include "GHOST_defines.var"

int				ti_i
int				ti_flag_locked

vector		tv_pos

object		to_duplicated

if (i_flag_sortie_etat)
{
	i_flag_sortie_etat = faux
	
	i_perfored_module_index = -1
	return
}

if (i_etat_courant != GHOST_ETAT_Corde)
{
	// INTIALISATION
	i_dernier_etat = i_etat_courant
	i_etat_courant = GHOST_ETAT_Corde
	
	if (fct_last_etat)
	{
		i_flag_sortie_etat = vrai
		AI_Execute(fct_last_etat)
	}

	fct_last_etat = "GHOST_ETAT_Corde"

	// RAGDOLL ============================
	ai_modules_locked[0] = vrai

	i_on_ground_modules_nb = 0
	i_in_water_modules_nb = 0

	f_delay_until_last_wall_col = 1000.0

	f_ragdoll_damping = 1.0
	i_flag_start_ragdoll_damping = faux

	for (ti_i = 0; ti_i < i_modules_nb; ti_i++)
	{
		av_bone_col_normal[ti_i] = Cv_NullVector
		af_bone_ground_col_timer[ti_i] = 1000.0
//		af_modules_water_Z[ti_i] = f_water_Z
	}
	// RAGDOLL ============================

	f_time_start_etat = 0.0
}
else
{
	f_time_start_etat += TIME_GetDt()
}

// ANALYSE ===============================================================
tv_pos = @o_main_actor OBJ_PosGet()
tv_pos -= @o_main_actor OBJ_SightGet() * 3.0
tv_pos.z += 1.0
tv_pos = MATH_VecBlend(OBJ_PosGet(), tv_pos, 4.0 * TIME_GetDt())
OBJ_PosSet(tv_pos)

GHOST_Rag_Doll(0)

if (i_on_ground_modules_nb > i_modules_nb * 0.75)
	AI_TrackCurChangeNow("GHOST_ETAT_Basic")

//if (f_time_start_etat  && IO_ButtonJustPressed(JoyPSX_Button_croix))
//	AI_TrackCurChangeNow("GHOST_ETAT_Basic")