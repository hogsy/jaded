int				ti_nbmsg
message 	msg
int				ti_launch
object		to_Cible
float			tf_Time
vector		tv_temp

//---------( state )--------------------------------------------
mi_State = Ci_bambou_state_initwait
ti_launch = faux

//---------( GFX )--------------------------------------------
if (mi_flamme)
	AI_Execute( "Javelin_GFX_fire1" )
	
//if ( OBJ_CapaTest( OBJ_Capa_14 ) )
//{
//	msg.msg_sender = OBJ_Me()
//	msg.msg_id = msg_id_grenadeshoot
//	msg.msg_gao1 = AI_MainActorGet(C_ID_Jack)
//	msg.msg_vec1 = cvector( 1, 0, 0)
//	msg.msg_vec2 = cvector( 0, 0, 1.5)
//	MSG_Send( msg )
//	
//	msg.msg_id = msg_id_grenadeburning 
//	MSG_Send( msg )
//}

// Recherche des messages arrivés
ti_nbmsg = MSG_GetCount()
while	( ti_nbmsg )
{
	msg = MSG_Get()
	ti_nbmsg = MSG_GetCount()
	
	if (msg.msg_id == msg_id_grenadeshoot )
	{
		mo_Sender = msg.msg_sender
		if (!mo_Sender)
			mo_Sender = OBJ_Me()
		to_Cible = msg.msg_gao1
		mv_LaunchGravity  = msg.msg_vec3
		if (MATH_VecNull( mv_LaunchGravity ) )
			mv_LaunchGravity  = Cv_NormalGravity
			
		if (to_Cible)
		{
			tv_temp = msg.msg_vec1
			tf_Time = tv_temp.x
			tv_temp = @to_Cible OBJ_PosGet()
			if( @to_Cible OBJ_FlagsIdentityTest( OBJ_C_IdentityFlag_Dyna ) )
			{
				tv_temp += (@to_Cible DYN_SpeedGetVector()) * tf_Time
			}
			tv_temp += msg.msg_vec2
			mv_LaunchSpeed = DYN_LIB_ImpulsionGet_Friction
			(
				OBJ_PosGet(), 
				tv_temp, 
				mv_LaunchGravity , 
				1.0,
				tf_Time,
				0,
				0.0
			)
			mv_LaunchFriction  = cvector(1.0, 1.0, 1.0)
			ti_launch = 1
		}
	}
	
	if ( msg.msg_id == msg_id_grenadelaunch )
	{
		mo_Sender = msg.msg_sender
		if ( !mo_Sender ) mo_Sender = AI_MainActorGet(C_ID_Joueur)
		mv_LaunchSpeed = msg.msg_vec1
		mv_LaunchGravity = msg.msg_vec2
		mv_LaunchFriction = msg.msg_vec3
		mo_LockObj = msg.msg_gao4
		mv_LockObj = msg.msg_vec4
		ti_launch = 1
	}

	if (msg.msg_id == msg_id_grenadefall )
	{
		mo_Sender = msg.msg_sender
		if (!mo_Sender) mo_Sender = AI_MainActorGet(C_ID_Joueur)
		mv_LaunchSpeed = msg.msg_vec1
		mv_LaunchGravity = Cv_NormalGravity
		mv_LaunchFriction = cvector( 1.0, 1.0, 0)
		mi_fall = 1
		DYN_On()
		DYN_SpeedSetVector(mv_LaunchSpeed)
		ti_launch = 1
	}

	if (msg.msg_id == msg_id_grenadedestroy )
	{
//		AI_Execute( "Javelin_destroy" )
		OBJ_Destroy()
		return
	}
	
	if (msg.msg_id == msg_id_grenadeburning )
		mi_flamme = vrai
}


if (ti_launch)
{
	OBJ_FlagInvisibleSet( 0 ) 
	AI_TrackCurChangeNow( "javelin_initlaunch" )
}
