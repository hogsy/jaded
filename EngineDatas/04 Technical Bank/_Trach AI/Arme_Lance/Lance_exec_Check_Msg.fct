#include "Lance_defs.var"

message 	msg
int				ti_nbmsg
int				ti_launch
object		to_Cible
float			tf_Time
vector		tv_temp

i_msg_launch_received = faux

ti_launch = faux

// Recherche des messages arrivés
ti_nbmsg = MSG_GetCount()
while	( ti_nbmsg )
{
	msg = MSG_Get()
	ti_nbmsg = MSG_GetCount()

	switch( msg.msg_id )
	{
		// lancée
		case msg_id_grenadelaunch :
			mo_Sender = msg.msg_sender
			if ( ! mo_Sender )
				mo_Sender = AI_MainActorGet(C_ID_Joueur)
			mv_LaunchSpeed = msg.msg_vec1
			mv_LaunchGravity = msg.msg_vec2
			mv_LaunchFriction = msg.msg_vec3
			mo_LockObj = msg.msg_gao4		// target !!!!
			mv_LockObj = msg.msg_vec4
			ti_launch = 1
			if ( msg.msg_int2 )
				mi_DigwaszaiPaf = vrai		// digwazai !!!!!
			break
		
		// dropée
		case msg_id_grenadefall :
			mo_Sender = msg.msg_sender
			if (! mo_Sender)
				mo_Sender = AI_MainActorGet(C_ID_Joueur)
			mv_LaunchSpeed = msg.msg_vec1
			mv_LaunchGravity = Cv_NormalGravity
			mv_LaunchFriction = cvector( 1.0, 1.0, 0)
			ti_launch = 1
			mi_fall = 1
			break
		
		// détruite ?	
		case msg_id_grenadedestroy :
			DBG_TraceObject(OBJ_Me())
			DBG_TraceString(" exec check msg, msg grenadedestroy = destroy\n")
			OBJ_Destroy()
			return
			break
	}
}


// allumeeeeeeez le feeeeeuuuu !!!! 
if( ! mi_flamme_avant && mi_flamme )
	SND_RequestPlay(SND_SetFire)
mi_flamme_avant = mi_flamme


// lancez !!!
if( ti_launch )
{
	OBJ_FlagInvisibleSet(faux)
	i_msg_launch_received = vrai
}

