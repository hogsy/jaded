//-------------------------------------------------------------------------------------------------------------------
#include "SND_BP_Constant.var"



//-------------------------------------------------------------------------------------------------------------------
int i, ti_trigger


//-------------------------------------------------------------------------------------------------------------------
for(i=0; i<SND_BP_Cte_SndRef_MaxNb; i++)
{
	if( ai_Indexes[i] < 0 ) continue
	if( ! AI_TriggerIsValid(at_Trigger[i]) ) break
	
	ti_trigger = call_trigger(at_Trigger[i])
	
	switch(mai_State[i])
	{
		case SND_BP_Cte_State_WaitPlaying :
			if( ! ti_trigger ) break
			// callback au play
			if(AI_TriggerIsValid(at_Callback[i]))	call_trigger(at_Callback[i])
			// play
			SND_Play(ai_Indexes[i])
			mai_State[i] = SND_BP_Cte_State_WaitStopping 
			break
			
				
		case SND_BP_Cte_State_WaitStopping :
			if( (i_Stop == SND_BP_Cte_Stop_When_trigger_is_off ) && ! ti_trigger )
			{
				SND_Stop(ai_Indexes[i])
				if(AI_TriggerIsValid(at_StopCallback[i]))	call_trigger(at_StopCallback[i])

				if(i_TriggerScan == SND_BP_Cte_TriggerScan_Inactive_after_1st_playing) 
					mai_State[i] = SND_BP_Cte_State_Dead
				else
					mai_State[i] = SND_BP_Cte_State_WaitPlaying
			}
			else if( (i_Play == SND_BP_Cte_Play_While_trigger_is_on ) && ti_trigger )
			{
				if( ! SND_IsPlaying(ai_Indexes[i]) )
					SND_Play( ai_Indexes[i] )
			}
			break
		
	
		default: break		
	}
}
