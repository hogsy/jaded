#include "KPluieDeLances_defines.var"

message 	tm_trigger

AI_Execute( "KPDL_exec_CHECK_msg" )

if (AI_TriggerIsValid(tr_attaque))
{
	tm_trigger = AI_TriggerGetMsg(tr_attaque)
			
	if (call_trigger( tr_attaque) )
	{
		if (o_cible != tm_trigger.msg_gao5)
		{
			o_cible = tm_trigger.msg_gao5
		}	
			
		AI_TrackChange(2, "KPluieDeLances_etat_attaque")
	}
	else 
	{
		AI_TrackChange(2, "KPluieDeLances_etat_attente")	
	}
}

//JIMI_NOTE: adding handling of external trigger of this effect for use with KWaszai
if ( mi_IsDigwazsaiControlled )
{
	if ( mi_IsExternalForceFire )
	{
		mi_IsExternalForceFire = faux
		
		mi_ForceFireComplete	= faux
		
		tm_trigger.msg_gao1 = o_cible
	
		AI_TrackChange( 2, "KPluieDeLances_etat_attaque" )
	}
	else
	{
		AI_TrackChange(2, "KPluieDeLances_etat_attente")
	}
}

AI_Execute("KPluieDeLances_exec_gere_custom_auto_paf")

AI_Execute("KPluieDeLances_exec_gere_son")