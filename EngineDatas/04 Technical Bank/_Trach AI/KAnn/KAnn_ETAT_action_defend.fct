//#include "KAnn_Defines.var"
//
//int ti_i
//messageid tmid_interet
//
//object to_owner 
//float 	tf_dist
//vector tv_dist
//int ti_status
//int ti_interaction_type
//object to_main, to_target
//int	ti_lance 
//float tf_time 
//vector tv_impulsion
//float tf_range
//vector tv_temp
//message tm_msg
//vector tv_gravity 
//vector tv_sight
//object to_rack
//
//#define Cf_grenade_XY_friction				1.0
//#define Cf_grenade_hauteur_impulsion	1.0
//
//// SORTIE ETAT ===================================================================
//if (i_sort_etat)
//{
//	i_sort_etat = faux
//	
//	if (i_has_weapon)
//	{
//		//i_has_weapon = 0
//		//ANI_ShapeSelect(Anim_Canal_Snap_MainD, 0)
//		//ANI_ShapeSelect(Anim_Canal_Snap_MainD+1, 0)
//		//ANI_ShapeSelect(Anim_Canal_Snap_MainD+2, 0)
//	}
//	
//	return
//}
//
//// INITIALISATION ETAT ==============================================================
//if (i_etat_courant != ETAT_Action_Defend)
//{
//	i_dernier_etat = i_etat_courant
//	i_etat_courant = ETAT_Action_Defend
//
//	if (fct_last_etat)
//	{
//		i_sort_etat = vrai
//		AI_Execute(fct_last_etat)
//	}
//
//	fct_last_etat = AI_TrackCurGet()
//	
//	// AUTORISATIONS DES GRABS
//	for (ti_i = 0; ti_i < Ci_LNK_TYPE_NB; ti_i++)
//		ai_SRV_ENABLE[ti_i] = faux
//	ai_SRV_ENABLE[Ci_LNK_GRAB_RAPTOR]		= vrai
//	ai_SRV_ENABLE[Ci_LNK_GRAB_TRANSPORTE]	= vrai
//	ai_SRV_ENABLE[Ci_LNK_KKGRAB_OBJECT]	= vrai
//	ai_SRV_ENABLE[Ci_LNK_INTERACTION]	= vrai
//
//	if (i_has_weapon)
//		ACT_ActionSet(Ann_att_enjoue_bambou)
//	else
//		ACT_ActionSet(Ann_normal_attente)
//
//	f_time_start_etat = 0.0
//	o_fight_actor = nobody
//	i_action_finished = 0
//	
//}
//else
//{
//	f_time_start_etat += TIME_GetDt()
//}
//
//
//// ANALYSE =======================================================================================================
//
//AI_Execute("KAnn_exec_serveur_get")
//if(ao_SRV[Ci_LNK_GRAB_RAPTOR])
//	macro_change_etat("KAnn_ETAT_grabbed_raptor")
//	
//if(ao_SRV[Ci_LNK_GRAB_TRANSPORTE])
//	macro_change_etat("KAnn_ETAT_grabbed_bat")
//
//if(ao_SRV[Ci_LNK_KKGRAB_OBJECT])
//	macro_change_etat("KAnn_ETAT_grabbed_KK")
//
//AI_Execute("KAnn_exec_CHECK_paf")
//if (o_paf_sender) 
//	macro_change_etat("KAnn_ETAT_paf")
//
//i_action = @o_safe_wp OBJ_CapaGet() & WP_Capa_Action
//if ( ! i_action)
//{
//	// if no action, go to next waypoint
//	macro_change_etat("KAnn_ETAT_follow_network")	
//}
//
//// COMPORTEMENT =======================================================================================================
//to_rack = o_safe_wp.des_object1
//
//if (!i_has_weapon) // go to rack
//{
//	if ( ! (@to_rack COL_BV_PivotCollide(OBJ_Me())) )
//	{
//		ACT_ActionSet(Ann_stress_trot)
//	
//		// goto rack of javelins
//		tv_sight = MATH_VecNormalize(@to_rack OBJ_PosGet() - OBJ_PosGet())
//		tv_sight 	= MATH_VecBlend(OBJ_SightGet(),tv_sight ,TIME_GetDt() * 10)
//		OBJ_BankingGeneralSet(tv_sight ,Cv_VerticalVector)		
//	}
//	else
//	{
// 		ACT_ActionSet(Ann_ramasse_debout)
//	}
//	
//	if (ACT_ActionGet() == Ann_ramasse_debout && ANI_CurrentFrameGet(0) > 10)
//	{
//		ANI_ShapeSelect(Anim_Canal_Snap_MainD, 10)  // bambou
//		ANI_ShapeSelect(Anim_Canal_Snap_MainD+1, 3)
//		ANI_ShapeSelect(Anim_Canal_Snap_MainD+2, 3)
//		
// 		i_has_weapon = 1	
//
//	}
//	
//}
//else if (! i_back_to_safe_wp) // go back to safe wp
//{
//	if ( ! (@o_safe_wp COL_BV_PivotCollide(OBJ_Me())) )
//	{
//		if (ACT_ActionGet() == Ann_ramasse_debout && ACT_ActionFinished())
//		{
//			ACT_ActionSet(Ann_stress_trot)	
//		}
//		
//		if (ACT_ActionGet() == Ann_stress_trot)
//		{
//			// goto rack of javelins
//			tv_sight = MATH_VecNormalize(@o_safe_wp OBJ_PosGet() - OBJ_PosGet())
//			tv_sight 	= MATH_VecBlend(OBJ_SightGet(),tv_sight ,TIME_GetDt() * 10)
//			OBJ_BankingGeneralSet(tv_sight ,Cv_VerticalVector)	
//		}
//	}
//	else 
//	{
//		ACT_ActionSet(Ann_att_enjoue_bambou)
//		i_back_to_safe_wp = 1
//	}
//	
//}
//
//
//if (ao_SRV[Ci_LNK_INTERACTION])
//{
//	ti_interaction_type = LNK_InteractionTypeGet(amid_SRV_LIAISON_ID[Ci_LNK_INTERACTION])
//	o_fight_actor = ao_SRV[Ci_LNK_INTERACTION]
//	
//	if (ti_interaction_type == C_INTER_FIGHT_WAIT_FOR_ANN)
//	{
//		if (ACT_ActionGet() == Ann_att_enjoue_bambou)
//		{
//			ti_interaction_type = C_INTER_FIGHT_ANN_READY
//			LNK_InteractionTypeSet(amid_SRV_LIAISON_ID[Ci_LNK_INTERACTION], ti_interaction_type )
//			ACT_ActionSet(Ann_att_enjoue_bambou)
//		}
//	}
//	else if (ti_interaction_type == C_INTER_FIGHT_ENNEMY_ATTACK)
//	{
//		if (ACT_ActionGet() == Ann_frappe_bambou && ACT_ActionFinished())
//		{	
//			ACT_ActionSet(Ann_att_enjoue_bambou)
//			ti_interaction_type = C_INTER_FIGHT_ANN_READY
//			LNK_InteractionTypeSet(amid_SRV_LIAISON_ID[Ci_LNK_INTERACTION], ti_interaction_type )
//		}
//		
//		if (ACT_ActionGet() != Ann_frappe_bambou)
//			ACT_ActionSet(Ann_frappe_bambou)
//		
//	}
//	
//	if (ACT_ActionGet() != Ann_ramasse_debout)
//	{
//		tv_sight = MATH_VecNormalize(@o_fight_actor OBJ_PosGet() - OBJ_PosGet())
//		tv_sight = MATH_VecBlend(OBJ_SightGet(),tv_sight, TIME_GetDt() * 5)
//		OBJ_BankingGeneralSet( tv_sight ,Cv_VerticalVector ) 
//	}
//}
//else
//{
//	if (ACT_ActionGet() == Ann_att_enjoue_bambou)
//	{
//		tv_sight = MATH_VecNormalize(@o_KONG OBJ_PosGet() - OBJ_PosGet())
//		tv_sight = MATH_VecBlend(OBJ_SightGet(),tv_sight, TIME_GetDt() * 5)
//		OBJ_BankingGeneralSet( tv_sight ,Cv_VerticalVector ) 
//	}
//}
//	
//
//
//
//