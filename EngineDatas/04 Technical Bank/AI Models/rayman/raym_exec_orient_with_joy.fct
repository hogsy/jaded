#include "r_defines.var"

int			ti_calcul_orient
vector	tv_sight

ti_calcul_orient = vrai
switch ( ACT_ActionGet())
{
	case RM_Act_Punch0 :
	case RM_Act_PunchR0 :
	case RM_Act_Punch1 :
	case RM_Act_PunchR1 :
	case RM_Act_Punch2 :
	case RM_Act_PunchR2 :
	case RM_Act_Punch3 :
	case RM_Act_PunchR3 :
	case RM_Act_Punch4 :
	case RM_Act_PunchR4 :
	case RM_Act_PunchR5 :
	case RM_Act_PunchU3 :
	case RM_Act_PunchU3v1 :
	case RM_Act_PunchU3v2 : 
	case RM_Act_PunchDragon :
//	case RM_Act_PunchUR : // IL A LE DROIT
						
		if ( PROC_RM_ModeLookON() && o_fight_actor)
		{
			tv_sight = @o_fight_actor  OBJ_PosGet() - OBJ_PosGet()
			MATH_VecSetHorzNormalize( tv_sight)
		}
		else
			tv_sight = v_frappe_joy
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), tv_sight, 9.0 * TIME_GetDt()), Cv_VerticalVector)
		break
	case RM_Act_PunchUR0 :
	case RM_Act_PunchUR2 :
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_joy_sight_normalized, 6.0 * TIME_GetDt()) , Cv_VerticalVector)	
		break
	case RM_Act_Ramasse : 
	case RM_Act_RamasseMove : 
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_joy_sight_normalized, 6.0 * TIME_GetDt()) , Cv_VerticalVector)
		if( !ACT_ActionFinished())
			break
	case RM_Act_Grappin_Launch : 
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_grappin_lance_memo_dir, 6.0 * TIME_GetDt()) , Cv_VerticalVector)
		if( !ACT_ActionFinished())
			break
	case RM_Act_ReceptionRoulade : 
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_esquive_joy, 8.0 * TIME_GetDt()) , Cv_VerticalVector)
		if( !ACT_ActionFinished())
			break	
	case RM_Act_Esquive : 
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_esquive_joy, 8.0 * TIME_GetDt()) , Cv_VerticalVector)
		if( !ACT_ActionFinished())
			break
	case RM_Act_Use_Gun : 
	case RM_Act_Use_Grenade : 
	case RM_Act_Use_CleEchec : 
	case RM_Act_Use_CleMarche : 
		if ( o_fight_actor && i_flag_look)
		{
			tv_sight = @o_fight_actor  OBJ_PosGet() - OBJ_PosGet()
			MATH_VecSetHorzNormalize( tv_sight)
		}	
//		else if ( o_grappin_hotspot)
//		{
//			tv_sight = @o_grappin_hotspot OBJ_PosGet() - OBJ_PosGet()
//			tv_sight  = Proc_Vec_HorzNormalise(tv_sight, v_joy_sight_normalized)			
//		}
		else if ( o_use_target && o_grab_object)
		{
			tv_sight = @o_use_target OBJ_PosGet() - @o_grab_object OBJ_PosGet()
			tv_sight  = Proc_Vec_HorzNormalise(tv_sight, v_joy_sight_normalized)			
		}
		else if( ! MATH_VecNullToler(v_use_sight, 0.01) )
			tv_sight = v_use_sight
		else
			tv_sight = OBJ_SightGet()
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), tv_sight, 15.0 * TIME_GetDt()), Cv_VerticalVector)
		break
	case RM_Act_Grappin_Marto :
		tv_sight = @o_grappin_hotspot OBJ_PosGet() - OBJ_PosGet()
		tv_sight  = Proc_Vec_HorzNormalise(tv_sight, v_joy_sight_normalized)			
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), tv_sight, f_grappin_blend_marto),Cv_VerticalVector)
		break
	case RM_Act_ChuteContreMur :
//		if ( MATH_FloatNullEpsilon( f_joy_norm))
			tv_sight = Proc_Vec_HorzNormalise( COL_NormalGet(COL_C_Wall), OBJ_SightGet())
//		else
//			tv_sight = v_joy_sight_normalized
		OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), tv_sight, 8.0 * TIME_GetDt()),Cv_VerticalVector)
		break
	case RM_Act_SpiderImpul :
		OBJ_BankingGeneralSet( OBJ_SightGet(), Cv_VerticalVector)
		break	
	default: 
		if ( MOVE_MODE() == C_Move_Danse)
		{
			// AIDE A L ORIENTATION DANS LES AXES DU MONDE
			ti_calcul_orient = faux			
		}
		else if ( o_fight_actor && MATH_FloatNullEpsilon( f_joy_norm))
		{
			tv_sight = @o_fight_actor  OBJ_PosGet() - OBJ_PosGet()
			MATH_VecSetHorzNormalize( tv_sight)
			OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), tv_sight, 5.0 * TIME_GetDt()), Cv_VerticalVector)
		}
//		else if ( o_grappin && MATH_FloatNullEpsilon( f_joy_norm) && ! MATH_VecNullEpsilon( v_grappin_orient))
//		{
//			tv_sight = @o_grappin OBJ_PosGet() - OBJ_PosGet()
//			MATH_VecSetHorzNormalize( tv_sight)
//			OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), tv_sight, 5.0 * TIME_GetDt()), Cv_VerticalVector)			
//		}
		else if ( ! MATH_VecNullEpsilon(v_force_JOY))
		{
			if(  f_traction_speed_time > 2.0)
				OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_force_JOY, 3.0 * TIME_GetDt()), Cv_VerticalVector)		
			else
				OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_force_JOY, 5.0 * TIME_GetDt()), Cv_VerticalVector)		
			v_orient_JOY = v_force_JOY
			ti_calcul_orient = faux
		}
		else if ( ! MATH_VecNullEpsilon(v_orient_JOY))
		{
			MATH_VecSetNormalize(v_orient_JOY)
			OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_orient_JOY, 8.0 * TIME_GetDt()), Cv_VerticalVector)
			if ( MATH_VecDotProduct( OBJ_SightGet(), v_orient_JOY) >= Cf_Cos5)
				v_orient_JOY = Cv_NullVector
			ti_calcul_orient = faux
		}
		else
		{
			OBJ_BankingGeneralSet( MATH_VecBlendRotate( OBJ_SightGet(), v_joy_sight_normalized, 5.0 * TIME_GetDt()), Cv_VerticalVector)
			ti_calcul_orient = faux
		}
}

if ( ti_calcul_orient)
	v_orient_JOY = OBJ_SightGet()
