Include_UltraProcedure_Header

object	to_gao


// PAUSE / UNPAUSE (Mettre la CAPA avant si on souhaite etre en pause de suite)
if (OBJ_CapaTest(OBJ_Capa_15))
{
	if (!i_pause_on)
	{
		i_pause_on = vrai
		TIME_Lock()
		WOR_Pause(0,0xFFFFFFFF)
	}
}
else if (i_pause_on)
{
	i_pause_on = faux
	WOR_UnPause(0,0xFFFFFFFF)
	TIME_Unlock()
}


// SECTORISATION
if (OBJ_CapaTest(OBJ_Capa_14))
{
	if (i_old_sector == -1)
	{
		i_old_sector = SCT_GetCurrent()
		SCT_SetCurrent(i_secteur_cine)
		to_gao = @get_global o_AI_secto_gao
		if (to_gao)
			@to_gao Proc_Sec_AISecto_ADD()
	}
}
else if (i_old_sector != -1)
{
	if (i_old_sector > 0)
	{
		SCT_SetCurrent(i_old_sector)
		to_gao = @get_global o_AI_secto_gao
		if (to_gao)
			@to_gao Proc_Sec_AISecto_ADD()
	}
	i_old_sector = -1
}	


// WAIT FOR END
if( EVT_IsStopAll() )
{

	if (i_pause_on)
	{
		i_pause_on = faux
		WOR_UnPause(0,0xFFFFFFFF)
		TIME_Unlock()
	}

	if (i_old_sector > 0)
	{
		SCT_SetCurrent(i_old_sector)
		to_gao = @get_global o_AI_secto_gao
		if (to_gao)
			@to_gao Proc_Sec_AISecto_ADD()
	}
	i_old_sector = -1

	if( Loop )
		AI_TrackCurChangeNow("AE_WaitActivation")
	else
		OBJ_Destroy()
}