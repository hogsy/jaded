#include "TXT_Encart_defs.var"

int 		res, res1, res2
int			ti_texte
object	to_obj

//===================================================================================

res = vrai
if(!OBJ_CapaTest(OBJ_Capa_1))
{
	res = faux
	// --------( TYPE_HAYESPSSTABLE )--------
	if (mi_Type == TYPE_HAYESPSSTABLE )
	{
//		to_obj = @"univ" ao_AllHumains[ C_ID_Hayes ]
//		if (to_obj && (LIBHumains_GetPsstable( VIEW_GetObject(0) ) == to_obj))
//			res = vrai
	}
	// --------( TYPE_HAYESPSSTE )--------
	else if (mi_Type == TYPE_HAYESPSSTE )
	{
//		to_obj = @"univ" ao_AllHumains[ C_ID_Hayes ]
//		if ( LIBHumains_Psste( to_obj ) )
//			res = vrai
	}
	// --------( TYPE_GEN )--------
	else if ( mi_TriggerOn )
	{
		// Test multi trigger
		res = call_trigger( mt_TriggerOn0 )
		
		if (mi_TriggerOn> 1 )
		{
			if ( !( ( mt_TriggerOnOp_01 == OPor ) && res ) && !( ( mt_TriggerOnOp_01 == OPand ) && !res ) )
			{
				res2 = call_trigger( mt_TriggerOn1 )
				if ( mt_TriggerOnOp_01 == OPxor )
					res = res ^ res2
				else
					res = res2
			}
		}
		if (mi_TriggerOn > 2 )
		{
			if ( !( ( mt_TriggerOnOp_12 == OPor ) && res ) && !( ( mt_TriggerOnOp_12 == OPand ) && !res ) )
			{
				res2 = call_trigger( mt_TriggerOn2 )
				if ( mt_TriggerOnOp_12 == OPxor )
					res = res ^ res2
				else
					res = res2
			}
		}
	}
}

//===================================================================================
res1 = vrai
if(!OBJ_CapaTest(OBJ_Capa_0))
{
	res1 = faux
	// --------( TYPE_HAYESPSSTABLE )--------
	if (mi_Type == TYPE_HAYESPSSTABLE )
	{
//		to_obj = @"univ" ao_AllHumains[ C_ID_Hayes ]
//		if ( LIBHumains_Psste( to_obj ) )
//			res1 = vrai
	}
	// --------( TYPE_HAYESPSSTE )--------
	else if (mi_Type == TYPE_HAYESPSSTE )
	{
//		to_obj = @"univ" ao_AllHumains[ C_ID_Hayes ]
//		if ( @to_obj OBJ_CapaTest(OBJ_Capa_15 ) )
//			res1 = vrai
	}
	// --------( TYPE_GEN )--------
	else if ( mi_TriggerOff )
	{
		// Test multi trigger
		res1 = call_trigger( mt_TriggerOff0 )
		
		if (mi_TriggerOff> 1 )
		{
			if ( !( ( mt_TriggerOffOp_01 == OPor ) && res1 ) && !( ( mt_TriggerOffOp_01 == OPand ) && !res1 ) )
			{
				res2 = call_trigger( mt_TriggerOff1 )
				if ( mt_TriggerOffOp_01 == OPxor )
					res1 = res1 ^ res2
				else
					res1 = res2
			}
		}
		if (mi_TriggerOff > 2 )
		{
			if ( !( ( mt_TriggerOffOp_12 == OPor ) && res1 ) && !( ( mt_TriggerOffOp_12 == OPand ) && !res1 ) )
			{
				res2 = call_trigger( mt_TriggerOff2 )
				if ( mt_TriggerOffOp_12 == OPxor )
					res1 = res1 ^ res2
				else
					res1 = res2
			}
		}
	}
}

//===================================================================================

if ( res1 )
{
	// Ok je valide le CP (ok ok a chaque trame c'est pas top)
	if (i_SF_NePlusSeRejouer)
		Super_SpecialFlag_set(i_SF_AlreadyCP)											// Set SF

	if(OBJ_CapaTest(OBJ_Capa_2)) AI_Execute( "TXTEncart_EncartHide" )
	OBJ_CapaSet( 0, OBJ_Capa_2 )
	if(!mi_NewLoop)
	{
		AI_TrackCurChange( "TXTEncart_End" )
		return
	}
}

if(res) 
{
	if ( !OBJ_CapaTest( OBJ_Capa_2 ) )
		AI_Execute( "TXTEncart_EncartShow" )
	OBJ_CapaSet( OBJ_Capa_2, 0 ) 
	ENCART_HideDialog( @"univ" Texte_InGame )
}
else
{
	if ( OBJ_CapaTest( OBJ_Capa_2 ) )
		AI_Execute( "TXTEncart_EncartHide" )
	OBJ_CapaSet( 0, OBJ_Capa_2 ) 
}