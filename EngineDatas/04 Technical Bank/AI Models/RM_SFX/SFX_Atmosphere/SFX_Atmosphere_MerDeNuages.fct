//------------------------------------------------------------------------------------------
//------------------------------------------------------------------------------------------
//								MER DE NUAGES
//------------------------------------------------------------------------------------------
//------------------------------------------------------------------------------------------

vector	tv_pos, tv_pos_mer, tv_pos_RM, tv_temp, tv_pos_CAM

if (o_mer_mobile && o_mer_lointaine)
{
	tv_pos_mer = @o_mer_mobile OBJ_PosGet()
	tv_pos_RM = @get_rayman OBJ_PosGet()
	tv_pos_CAM = @get_camera OBJ_PosGet()
	
	// Positionnement des plaques de mer
	tv_pos = tv_pos_RM
	if (o_omega)
		tv_pos.z = @o_omega OBJ_PosGet().z
	else
		tv_pos.z = 0.0
	
	if (o_mer_mobile)
		@o_mer_mobile OBJ_PosSet(tv_pos)
	
	if (o_mer_lointaine)
		@o_mer_lointaine OBJ_PosSet(tv_pos - cvector(0,0,50))
	
	
	// Calcul du taux de pénétration dans la mer
	if ((tv_pos_RM.z < (tv_pos_mer.z + f_dist_mer_nuages)) && f_dist_mer_nuages > 0.0)
		f_facteur_inside_mer = ((tv_pos_mer.z + f_dist_mer_nuages) - tv_pos_RM.z) / f_dist_mer_nuages
	else
		f_facteur_inside_mer = 0.0
	
	if (f_facteur_inside_mer > 1.0)
		f_facteur_inside_mer = 1.0
	
	
	if (o_sphere_fog)
	{
		@o_sphere_fog OBJ_FlagInvisibleSet(vrai)
//		// On place la sphère de fog juste en dessous de Rayman
//		tv_pos_mer = tv_pos_CAM// + cvector(0.0,0.0,6.5)
//		@o_sphere_fog OBJ_PosSet(tv_pos_mer)
//		
//		// On affiche lpus ou moins la sphère de fog en fonction de f_dist_inside_mer
//		@o_sphere_fog MAT_MT_SetLocalAlpha(0, 1, f_facteur_inside_mer * 255)
//	
//		i_alpha_nuages =  f_facteur_inside_mer * 255
//	
//		if (i_alpha_nuages > 0)
//		{
//			tv_temp = cvector(MATH_RandFloat(-3.0,3.0), MATH_RandFloat(-3.0,3.0), MATH_RandFloat(1.0,4.0))
//			PROC_SFX_NUAGE(i_GFX_Nuages, tv_pos_RM + cvector(0.0,0.0,-2.5), COLOR_SetRGBA(255,255,255,i_alpha_nuages), tv_temp)
//		}
//		else
//			if (i_GFX_Nuages != -1)
//				PROC_DESTROY_SFX(i_GFX_Nuages)
	}
}