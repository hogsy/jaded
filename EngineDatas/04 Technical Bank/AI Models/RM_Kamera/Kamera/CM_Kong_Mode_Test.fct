
#include "Kam_Defines.var"

object		to_cam 
vector		tv_axis
int				ti_string 
vector		tv_intersection
float			tf_dist 
vector		tv_collide_pos


// MECA SPECIALE ------------------------
i_MECA_Mode = Ci_MecaMode_Position
// MECA SPECIALE ------------------------

// Backup Gao pour les Transitions specifique en mode CChant
o_cc_kam_modifier_old = nobody

to_cam = VIEW_GetObject(0)

ti_string = STR_CreateText("Position Camera: ",cvector(0,0,0),0)
STR_AppendVector(ti_string,@to_cam OBJ_PosGet())

STR_AppendText(ti_string,"\nPerso Reference: ")
STR_AppendGao(ti_string, o_finish_actor)

STR_AppendText(ti_string,"\nPosition Perso Reference: ")
STR_AppendVector(ti_string, @o_finish_actor OBJ_PosGet())

tv_axis = @to_cam OBJ_PosGet() - @o_finish_actor OBJ_PosGet()

STR_AppendText(ti_string,"\nOffset Position LOCAL au Perso Reference: ")
STR_AppendVector(ti_string, @o_finish_actor MATH_VecGlobalToLocal(tv_axis))
if (IO_ButtonPressed(JoyPSX_Button_croix))
{
	DBG_TraceString("cvector")
	DBG_TraceVector(@o_finish_actor MATH_VecGlobalToLocal(tv_axis))
}

if ( MATH_LIB_Intersection_Dir_Plane(@to_cam OBJ_PosGet(), @to_cam OBJ_SightGet(), @o_finish_actor OBJ_PosGet(), -@to_cam OBJ_SightGet(), tf_dist, tv_collide_pos) )
{
//	DBG_RenderSphere(tv_collide_pos,1.0,color_rouge)
	STR_AppendText(ti_string,"\nCam Target Delta LOCAL au Perso Reference: ")
	STR_AppendVector(ti_string, @o_finish_actor MATH_VecGlobalToLocal(tv_collide_pos - @o_finish_actor OBJ_PosGet()))
	if (IO_ButtonPressed(JoyPSX_Button_croix))
	{
		DBG_TraceString("  cvector")
		DBG_TraceVector(@o_finish_actor MATH_VecGlobalToLocal(tv_collide_pos - @o_finish_actor OBJ_PosGet()))
	}
}

if (IO_ButtonPressed(JoyPSX_Button_croix))
{
	DBG_TraceEOL()
	DBG_BreakPoint()
}

if (	i_kong_camera_mode != Ci_Kamera_mode_TEST )
{
	// Init
	KamP_Mode_Set(Ci_Kamera_mode_TEST)
}

v_MECA_cam_target  = KamP_TargetGao_BlendPosGet(o_finish_actor, Cf_BlendPos_DefaultSpeed)
v_MECA_cam_target_delta = tv_collide_pos - @o_finish_actor OBJ_PosGet()
v_MECA_cam_pos = @to_cam OBJ_PosGet()
f_MECA_cam_focale = 1.2
