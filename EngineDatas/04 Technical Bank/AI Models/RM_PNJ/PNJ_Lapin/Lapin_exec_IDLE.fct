#include "PNJ_Lapin_defines.var"

object	to_target

// ENTREE EXEC IDLE =======================================================
if( f_IDLE_time == 0.0 )
{
	Lapin_DBG_Trace_String(DBG_Trace_Etat, "IDLE")
}
else
{
	f_IDLE_time += TIME_GetDt()
}


// RIDED ? ================================================================
if( o_Rided_Actor )
	macro_change_etat("Lapin_ETAT_RIDED")


// MORT ? =================================================================
if( ! f_LIFE_cur || i_Mort_JeMeNoie_flag )
	macro_change_etat("Lapin_ETAT_MORT")


// APPARITION ? ============================================================
if( o_App_next_wp )
	macro_change_etat("Lapin_ETAT_APPARITION")


// FUITE ? =================================================================
if( i_fuite_flag )
	macro_change_etat("Lapin_ETAT_FUITE")


// BEAT ? =================================================================
if( i_Beat_flag_danse )
	macro_change_etat("Lapin_ETAT_DANSE")

if( i_Beat_flag_alert )
	macro_change_etat("Lapin_ETAT_BEAT_ALERT")

// anti_mashing ? =============================================================
if( i_anti_mashing_flag )
	macro_change_etat("Lapin_ETAT_FIGHT")


// VOLEUR DE CLEF =========================================================
if( Fuite_Si_Clef && ( Lapin_ITEM_Has_Key() || Lapin_LUMS_Cage_Has() ) )
{
	Lapin_FUITE(o_main_actor)		// le lapin voleur reste en fuite !!
	i_etat_courant = -1
	macro_change_etat("Lapin_ETAT_FUITE")
}


// GRAPPIN CONTROL ? =====================================================
if( i_Grappin_Control_flag )
	macro_change_etat("Lapin_ETAT_GRAPPIN_CONTROL")


// PROTECT ? =============================================================
if( i_protect_flag )
	macro_change_etat("Lapin_ETAT_PROTECT")


// DODGE ? ===============================================================
if( i_dodge_flag )
	macro_change_etat("Lapin_ETAT_DODGE")


// PREVIOUS ETAT =========================================================
//if( i_use_previous_etat )
//{
//	i_use_previous_etat = faux
//	if( fct_previous_etat )
//		macro_change_etat(fct_previous_etat)
//}


// MANGER :) ==============================================================
if( Lapin_ITEM_Has_Carotte() )
{
	macro_change_etat("Lapin_ETAT_USE_ITEM")
}


// NO TARGET =============================================================
to_target = nobody
if( MSG_GlobalIsValid(mid_best_interet) )
	to_target = EVENT_InteretTargetGet(mid_best_interet)
if( ! to_target )
{
//	// TIMER LOOK APRES UN PAF 
//	if( i_etat_courant == ETAT_Lapin_PAF && f_IDLE_time < 1.5 )
//	{
//		Lapin_ACTION_Set(Lapin_ACTION_Attente_Get())
//		// je regarde derrière moi
//		i_flag_look = vrai
//		v_look_pos = v_paf_look_origin_memo
//		if( f_IDLE_time > 0.75 )
//		{
//			// je me retourne
//			v_force_sight = v_paf_look_origin_memo - OBJ_PosGet()
//			AI_Execute("Lapin_exec_way_orientation")
//		}
//		return
//	}
//	else
		macro_change_etat("Lapin_ETAT_ATTENTE")
}


// MAIN ETAT ============================================================
if( ! fct_main_etat )
	fct_main_etat = "Lapin_ETAT_ATTENTE"
macro_change_etat(fct_main_etat)


