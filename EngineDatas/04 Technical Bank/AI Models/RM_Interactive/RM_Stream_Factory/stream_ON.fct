vector	tv_sens
int			ti_nb
float		tf_pct, tf_dist, tf_ratio
object	to_obj, to_main 
int	pi_indice
int	pi_i
//----------
// SFX
float tf_IntensiteEjection
float expuls
float tf_vit_min, tf_vit_max
//----------

if ( AI_TriggerIsValid(TRIG_OFF) && call_trigger(TRIG_OFF))
{
	// SUPPRESSION DYNAMIQUE D'UN HOTSPOT

	pi_indice = ARR_ObjSearch(&@get_list_manager ao_stream[0], @get_list_manager i_stream_nb, OBJ_Me())
	if( pi_indice != -1 )
	{
		@get_list_manager i_stream_nb--
		for( pi_i = pi_indice; pi_i < @get_list_manager i_stream_nb; pi_i ++)
			@get_list_manager ao_stream[pi_i] = @get_list_manager ao_stream[(pi_i +1)]
	}	
	GFX_Seti(i_GFX_Stream, 13103, 0x00000000)						// Color phase 0
	GFX_Seti(i_GFX_Stream, 13104, 0x00000000)						// Color phase 1
	GFX_Seti(i_GFX_Rocks, 13103, 0x00000000)						// Color phase 0
	GFX_Seti(i_GFX_Rocks, 13104, 0x00000000)						// Color phase 1
	OBJ_FlagInvisibleSet(vrai)
	SND_RequestPlay(3)
	SND_Stop( i_SND_Loop)
	i_SND_Loop = -1
	AI_TrackCurChangeNow("stream_OFF")
}


//if ( MATH_RandFloat(0.0,1.0) < 0.5 )
if( i_particule_ON)
{
	//----------------------------------------------------------------------------------
	// SFX
	//----------------------------------------------------------------------------------
	// Fumée

	// DUREE DE VIE
	// Durée de la phase d'apparition
	tf_ratio = f_dist_max / 50.0
	GFX_Setf(i_GFX_Stream, 13003, 1.2 * tf_ratio )
	
	// Durée de la phase de mort
	GFX_Setf(i_GFX_Stream, 13004, 0.3 * tf_ratio )

	// Time random
	GFX_Setf(i_GFX_Stream, 13012, 0.75 * tf_ratio)
	tf_IntensiteEjection= 2.0
	GFX_Setv(i_GFX_Stream, 13200, OBJ_PosGet() + MATH_VecLocalToGlobal(cvector( MATH_RandFloat(-tf_IntensiteEjection,tf_IntensiteEjection), -0.0, MATH_RandFloat(-tf_IntensiteEjection,tf_IntensiteEjection))))
	GFX_Setv(i_GFX_Stream, 13201, OBJ_SightGet()* f_dist_max * 0.333) // 10.0)
	GFX_Setv(i_GFX_Stream, 13202, OBJ_SightGet()* f_dist_max) // 30.0)
	// Particules annexes
	expuls = 1.25
	tf_vit_min = f_dist_max / 3.0 //10.0
	tf_vit_max = f_dist_max //30.0
	GFX_Setv(i_GFX_Rocks, 13200, OBJ_PosGet()) //+ MATH_VecLocalToGlobal(cvector( MATH_RandFloat(-expuls ,expuls ), 0.0, MATH_RandFloat(-expuls , expuls ))))
	GFX_Setv(i_GFX_Rocks, 13201, cvector(OBJ_SightGet().x * tf_vit_min + MATH_RandFloat(-expuls, expuls), OBJ_SightGet().y * tf_vit_min+ MATH_RandFloat(-expuls, expuls), OBJ_SightGet().z * tf_vit_min + MATH_RandFloat(-expuls, expuls)))
	GFX_Setv(i_GFX_Rocks, 13202, cvector(OBJ_SightGet().x * tf_vit_max + MATH_RandFloat(-expuls, expuls), OBJ_SightGet().y * tf_vit_max + MATH_RandFloat(-expuls, expuls), OBJ_SightGet().z * tf_vit_max + MATH_RandFloat(-expuls, expuls)))
	//----------------------------------------------------------------------------------
}

DBG_RenderCircle( OBJ_PosGet() + (OBJ_SightGet() * f_zone_max * f_pct_force_max ), 3.0, OBJ_SightGet(), color_rouge)

// PALES
if ( o_pales)
	@o_pales OBJ_RotateLocalZ(-f_rot_speed * TIME_GetDt())
f_rot_speed = MATH_FloatBlend( f_rot_speed , f_rotation_max_pale, 5.0 * TIME_GetDt())

OBJ_CapaSet( Obj_Capa_Switch, none)

if ( COL_RayObject_Dist( OBJ_PosGet(), OBJ_SightGet(), f_zone_max, all, none, Ci_Filter_IdentityFlag, COL_C_Ray_on_ColMap_NoCrossable))
{
	f_dist_max = MATH_VecNorm( COL_RayObject_PosGet() - OBJ_PosGet())
}
else
	f_dist_max = f_zone_max
