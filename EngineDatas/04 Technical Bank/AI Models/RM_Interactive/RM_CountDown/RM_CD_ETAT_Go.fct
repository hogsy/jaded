#include "RM_CD_Defines.var"

// SORTIE ETAT 	===================================================================
if (i_sort_etat)
{
	RM_CD_DelSFX()
	PROC_SFX_COUNTDOWN_DESTROY_ALL_MODULE()

	if(o_CentreHalos)
		macro_del_callback_after_cam("RM_CD_cb_AfterCam")
	i_sort_etat = faux
	return
}

// INIT ETAT 	=====================================================================
if ( i_etat_courant != ETAT_RM_CD_Go)
{
	i_etat_courant = ETAT_RM_CD_Go
	if( fct_last_etat )
	{
		i_sort_etat = vrai
		AI_Execute(fct_last_etat)
	}
	fct_last_etat = AI_TrackCurGet()	
	f_time_start_etat = 0.0	
	f_CurTime=f_Time
	if(o_CentreHalos)
	{
		v_Centre=@o_CentreHalos OBJ_PosGet()
		macro_add_callback_after_cam("RM_CD_cb_AfterCam")
	}
}
else
{
	f_time_start_etat += TIME_GetDt()
}


// CHANGEMENT D ETAT =============================================================

if(f_CurTime<=0.0)
{
	if( AI_TriggerIsValid(TriggerExec_Missed))
		call_trigger(TriggerExec_Missed) 
//	AI_ReinitUniv()
	WOR_Reinit()
}
else
{
	if( AI_TriggerIsValid(TriggerTest_Success) && call_trigger(TriggerTest_Success))
	{
		if( AI_TriggerIsValid(TriggerExec_Success))
		{
			call_trigger(TriggerExec_Success)
		}
		AI_TrackCurChangeNow("RM_CD_ETAT_Succeed")
	}
}

// COMPORTEMENT ================================================================

f_CurTime -= MATH_FloatMin(f_CurTime,TIME_GetDt())

// RM_CD_TimePrint()