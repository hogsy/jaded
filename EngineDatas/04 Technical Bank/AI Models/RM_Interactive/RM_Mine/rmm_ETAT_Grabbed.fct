#include "rmm_defines.var"

vector	tv_pos

object	to_bone
object	to_Grabbed_Actor


// SORTIE ETAT ===================================================================
if (i_sort_etat)
{
	i_sort_etat = faux
	o_Grabbed_Actor = LNK_ServeurGet(Ci_LNK_GRAB_EAGLE, mid_Grabbed_LNK_ID, faux, nofunc, nofunc)

	PROC_MINE_DYN_ON()
	COL_ColSetActivationSet(C_bit_zdm_pied, none)
	COL_ColMapActivationSet(all, none)
	return
}

// INITIALISATION ETAT ==============================================================
if (i_etat_courant != ETAT_MINE_Grabbed)
{
	i_dernier_etat = i_etat_courant
	i_etat_courant = ETAT_MINE_Grabbed
	if (fct_last_etat)
	{
		i_sort_etat = vrai
		AI_Execute(fct_last_etat)
	}
	
	PROC_MINE_DYN_OFF()
	COL_ColSetActivationSet(none, C_bit_zdm_pied)
	COL_ColMapActivationSet(none, all)

	fct_last_etat = AI_TrackCurGet()
}

// CHANGEMENT D ETAT  ==============================================================

// GRABBED ???
to_Grabbed_Actor = LNK_ServeurGet(Ci_LNK_GRAB_EAGLE, mid_Grabbed_LNK_ID, vrai, nofunc, nofunc)
if( to_Grabbed_Actor != o_Grabbed_Actor )
{
	AI_TrackCurChangeNow("rmm_ETAT_Wait")
}

// COMPORTEMENT ==============================================================
if (@o_Grabbed_Actor AI_IsModel(get_PNJ_Shark_path))
{
	to_bone = LNK_GrabBoneGet(mid_Grabbed_LNK_ID)
	tv_pos = @to_bone OBJ_PosGet()
	tv_pos += @o_Grabbed_Actor OBJ_SightGet()
	tv_pos -= @o_Grabbed_Actor OBJ_BankingGet() * 0.2
	OBJ_PosSet(tv_pos)
	OBJ_BankingGeneralSet(@to_bone OBJ_SightGet(), @to_bone OBJ_BankingGet())
}
