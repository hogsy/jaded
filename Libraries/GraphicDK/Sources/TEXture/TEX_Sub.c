#include "BASe/MEMory/MEM.h"
#include "GDInterface/GDInterface.h"
#include "SDK/Sources/INOut/INO.h"

#ifdef PSX2_TARGET
#include "BINK.h"
#include "GS_PS2/Gsp_Bench.h"
#define SCREEN_HEIGHT   GspGlobal_ACCESS(Ysize)
#endif

#ifdef _GAMECUBE
#include "BINK/Bink.h"
extern ULONG gul_FRAME_BUFFER_HEIGHT;
#define SCREEN_HEIGHT   (gul_FRAME_BUFFER_HEIGHT)
#endif // _GAMECUBE

/*
void BINK_SUBOpen(char *TXTFile);
void BINK_SUBClose();
void BINK_DrawSUB(HBINK bink,u32 *Buffer,u32 XSize,u32 YSize);
*/
/****************************************************************************************************************************/
/* Subtitle Begin *************************************************************************************************************/
/****************************************************************************************************************************/
#ifdef _XBOX
#include "Gx8/bink/bink.h"
#include "gx8/Gx8FileError.h"
#define SCREEN_HEIGHT 480
#endif // _XBOX

#if (defined _XBOX)

/*
Fizedsys = 

	 !"#$%&'()*+,-./0123456789:;<=>?
	@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_
	`abcdefghijklmnopqrstuvwxyz{|}~
	ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü
	†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø
	¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ
	‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ
*/
// This Following font must be corrected with FONT_FixedSysCorrect()
unsigned char FONT_FixedSys[256][16] /*__attribute__((aligned(64))) */= {
	{0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x18,0x3c,0x3c, 0x3c,0x18,0x18,0x00,0x18, 0x18,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x66,0x66,0x66, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x6c,0x6c,0xfe, 0x6c,0x6c,0x6c,0xfe,0x6c, 0x6c,0x00,0x00,0x00,0x00,0x00}, 
	{0x18,0x18,0x3c,0x66,0x06, 0x0c,0x18,0x30,0x60,0x66, 0x3c,0x18,0x18,0x00,0x00,0x00}, {0x00,0x0e,0x1b,0x5b,0x6e, 0x30,0x18,0x0c,0x76,0xda, 0xd8,0x70,0x00,0x00,0x00,0x00}, {0x00,0x00,0x1c,0x36,0x36, 0x1c,0x06,0xf6,0x66,0x66, 0xdc,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x18,0x18,0x18, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x30,0x18,0x18, 0x0c,0x0c,0x0c,0x0c,0x0c, 0x18,0x18,0x30,0x00,0x00,0x00}, {0x00,0x00,0x0c,0x18,0x18, 0x30,0x30,0x30,0x30,0x30, 0x18,0x18,0x0c,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x6c, 0x38,0xfe,0x38,0x6c,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x18, 0x18,0x7e,0x18,0x18,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x38, 0x38,0x30,0x18,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x7e,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x38, 0x38,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x60,0x60,0x30, 0x30,0x18,0x18,0x0c,0x0c, 0x06,0x06,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x78,0xcc,0xec, 0xec,0xcc,0xdc,0xdc,0xcc, 0x78,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x30,0x38,0x3e, 0x30,0x30,0x30,0x30,0x30, 0x30,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x60,0x30,0x18,0x0c,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x60,0x38,0x60,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x0c,0x0c,0x6c, 0x6c,0x6c,0x66,0xfe,0x60, 0x60,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x06,0x06, 0x06,0x3e,0x60,0x60,0x30, 0x1e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x38,0x18,0x0c, 0x3e,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x60,0x30, 0x30,0x18,0x18,0x0c,0x0c, 0x0c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x3c,0x66,0x66, 0x6e,0x3c,0x76,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x66,0x66,0x7c,0x30,0x18, 0x1c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x38, 0x38,0x00,0x00,0x00,0x38, 0x38,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x38, 0x38,0x00,0x00,0x00,0x38, 0x38,0x30,0x18,0x00,0x00,0x00}, 
	{0x00,0x00,0x60,0x30,0x18, 0x0c,0x06,0x0c,0x18,0x30, 0x60,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x7e,0x00,0x7e,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x06,0x0c,0x18, 0x30,0x60,0x30,0x18,0x0c, 0x06,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x30,0x18,0x18,0x00,0x18, 0x18,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0xc3,0xc3, 0xf3,0xdb,0xdb,0xf3,0x03, 0xfe,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x18,0x3c,0x66, 0x66,0x66,0x7e,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3e,0x66,0x66, 0x66,0x3e,0x66,0x66,0x66, 0x3e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x06,0x06,0x06,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x1e,0x36,0x66, 0x66,0x66,0x66,0x66,0x36, 0x1e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x06,0x06, 0x06,0x3e,0x06,0x06,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x06,0x06, 0x06,0x3e,0x06,0x06,0x06, 0x06,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x06,0x06,0x76,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x66,0x66,0x66, 0x66,0x7e,0x66,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x60,0x60,0x60, 0x60,0x60,0x60,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x66,0x66,0x36, 0x36,0x1e,0x36,0x36,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x06,0x06,0x06, 0x06,0x06,0x06,0x06,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0xc6,0xc6,0xee, 0xd6,0xd6,0xd6,0xc6,0xc6, 0xc6,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0xc6,0xc6,0xce, 0xde,0xf6,0xe6,0xc6,0xc6, 0xc6,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x3e,0x66,0x66, 0x66,0x3e,0x06,0x06,0x06, 0x06,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x30,0x60,0x00,0x00,0x00}, {0x00,0x00,0x3e,0x66,0x66, 0x66,0x3e,0x36,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x06, 0x0c,0x18,0x30,0x60,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x18,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x66,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x66,0x66,0x66, 0x66,0x66,0x66,0x66,0x3c, 0x18,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0xc6,0xc6,0xc6, 0xd6,0xd6,0xd6,0x6c,0x6c, 0x6c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x66,0x66,0x2c, 0x18,0x18,0x34,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x66,0x66,0x66, 0x66,0x3c,0x18,0x18,0x18, 0x18,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x60,0x60, 0x30,0x18,0x0c,0x06,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x0c,0x0c, 0x0c,0x0c,0x0c,0x0c,0x0c, 0x0c,0x0c,0x0c,0x3c,0x00,0x00}, 
	{0x00,0x00,0x06,0x06,0x0c, 0x0c,0x18,0x18,0x30,0x30, 0x60,0x60,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x30,0x30, 0x30,0x30,0x30,0x30,0x30, 0x30,0x30,0x30,0x3c,0x00,0x00}, {0x18,0x3c,0x66,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xff,0x00,0x00}, 
	{0x1c,0x18,0x30,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x3c, 0x60,0x60,0x7c,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x06,0x06,0x3e, 0x66,0x66,0x66,0x66,0x66, 0x3e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x3c, 0x66,0x06,0x06,0x06,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x60,0x60,0x7c, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x3c, 0x66,0x66,0x7e,0x06,0x06, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x78,0x0c,0x0c, 0x0c,0x7e,0x0c,0x0c,0x0c, 0x0c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x7c, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x60,0x60,0x3e,0x00,0x00}, 
	{0x00,0x00,0x06,0x06,0x3e, 0x66,0x66,0x66,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x18,0x18,0x00,0x1e, 0x18,0x18,0x18,0x18,0x18, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x30,0x30,0x00,0x3c, 0x30,0x30,0x30,0x30,0x30, 0x30,0x30,0x30,0x1e,0x00,0x00}, {0x00,0x00,0x06,0x06,0x66, 0x66,0x36,0x1e,0x36,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x1e,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x7e, 0xd6,0xd6,0xd6,0xd6,0xd6, 0xc6,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x3e, 0x66,0x66,0x66,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x3c, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x3e, 0x66,0x66,0x66,0x66,0x66, 0x3e,0x06,0x06,0x06,0x00,0x00}, {0x00,0x00,0x00,0x00,0x7c, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x60,0x60,0x60,0x00,0x00}, {0x00,0x00,0x00,0x00,0x66, 0x76,0x0e,0x06,0x06,0x06, 0x06,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x7c, 0x06,0x06,0x3c,0x60,0x60, 0x3e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x0c,0x0c,0x7e, 0x0c,0x0c,0x0c,0x0c,0x0c, 0x78,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x66, 0x66,0x66,0x66,0x66,0x3c, 0x18,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0xc6, 0xd6,0xd6,0xd6,0xd6,0x6c, 0x6c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x66, 0x66,0x3c,0x18,0x3c,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x30,0x18,0x0f,0x00,0x00}, {0x00,0x00,0x00,0x00,0x7e, 0x60,0x30,0x18,0x0c,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x30,0x18,0x18, 0x18,0x0c,0x06,0x0c,0x18, 0x18,0x18,0x30,0x00,0x00,0x00}, 
	{0x00,0x00,0x18,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x18,0x18,0x18,0x18,0x00,0x00}, {0x00,0x00,0x0c,0x18,0x18, 0x18,0x30,0x60,0x30,0x18, 0x18,0x18,0x0c,0x00,0x00,0x00}, {0x00,0x00,0x8e,0xdb,0x71, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0xff,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x30,0x18,0x38, 0x38,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x38,0x38,0x30, 0x18,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x7e,0x7e,0x7e, 0x7e,0x7e,0x7e,0x7e,0x7e, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x0c,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x18,0x18,0x00,0x18,0x18, 0x3c,0x3c,0x3c,0x18,0x30,0x00}, {0x00,0x00,0x18,0x18,0x3c, 0x66,0x06,0x06,0x66,0x3c, 0x18,0x18,0x00,0x00,0x3c,0x00}, {0x00,0x00,0x3c,0x66,0x06, 0x06,0x3f,0x06,0x06,0x03, 0x7f,0x00,0x00,0x00,0xdc,0x00}, 
	{0x00,0x00,0x00,0x66,0x3c, 0x66,0x66,0x3c,0x66,0x00, 0x00,0x00,0x00,0x00,0x66,0x00}, {0x00,0x00,0x66,0x66,0x66, 0x3c,0x7e,0x18,0x7e,0x18, 0x18,0x00,0x00,0x00,0x3c,0x00}, {0x00,0x00,0x18,0x18,0x18, 0x18,0x18,0x00,0x00,0x18, 0x18,0x18,0x18,0x18,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x06, 0x1c,0x3c,0x66,0x66,0x3c, 0x38,0x60,0x66,0x3c,0x00,0x00}, 
	{0x00,0x66,0x66,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x0c,0x00}, {0x00,0x00,0x7e,0xc3,0x99, 0xa5,0x85,0xa5,0x99,0xc3, 0x7e,0x00,0x00,0x00,0x30,0x00}, {0x00,0x00,0x3c,0x60,0x7c, 0x66,0x7c,0x00,0x7e,0x00, 0x00,0x00,0x00,0x00,0x3c,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0xcc,0x66,0x33,0x66, 0xcc,0x00,0x00,0x00,0x66,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x7e,0x60,0x60,0x00, 0x00,0x00,0x00,0x00,0x0c,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x7e,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x30,0x00}, {0x00,0x00,0x7e,0xc3,0x9d, 0xa5,0xa5,0x9d,0xa5,0xc3, 0x7e,0x00,0x00,0x00,0x3c,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x66,0x00}, 
	{0x00,0x3c,0x66,0x66,0x3c, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x18, 0x18,0x7e,0x18,0x18,0x00, 0x7e,0x00,0x00,0x00,0xdc,0x00}, {0x00,0x00,0x1c,0x30,0x18, 0x0c,0x3c,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x0c,0x00}, {0x00,0x00,0x1c,0x30,0x18, 0x30,0x1c,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x30,0x00}, 
	{0x38,0x18,0x0c,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x3c,0x00}, {0x00,0x00,0x00,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0xde,0x06,0x06,0x03,0xdc,0x00}, {0x00,0x00,0xf8,0x7c,0x7e, 0x7e,0x7e,0x7c,0x78,0x60, 0x60,0x60,0x60,0x60,0x66,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x38,0x38,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00, 0x00,0x18,0x30,0x1c,0x00,0x00}, {0x00,0x00,0x18,0x1c,0x18, 0x18,0x18,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x0c,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x66,0x3c,0x00,0x7e,0x00, 0x00,0x00,0x00,0x00,0x30,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x00,0x33,0x66,0xcc,0x66, 0x33,0x00,0x00,0x00,0x3c,0x00}, 
	{0x00,0x06,0x07,0xc6,0x66, 0x36,0x18,0xec,0xf6,0xdb, 0xf8,0xc0,0x00,0x00,0x66,0x00}, {0x00,0x06,0x07,0xc6,0x66, 0x36,0x18,0x7c,0xc6,0x63, 0x30,0xf0,0x00,0x00,0x30,0x00}, {0x00,0x07,0x0c,0xc6,0x6c, 0x37,0x18,0xec,0xf6,0xdb, 0xf8,0xc0,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x00, 0x18,0x18,0x00,0x18,0x18, 0x0c,0x66,0x66,0x3c,0x00,0x00}, 
	{0x18,0x00,0x18,0x3c,0x66, 0x66,0x66,0x7e,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x18,0x3c,0x66, 0x66,0x66,0x7e,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x66,0x00,0x18,0x3c,0x66, 0x66,0x66,0x7e,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x76,0x00,0x18,0x3c,0x66, 0x66,0x66,0x7e,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, 
	{0x66,0x00,0x18,0x3c,0x66, 0x66,0x66,0x7e,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x66,0x3c,0x18,0x3c,0x66, 0x66,0x66,0x7e,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0xf0,0x38,0x3c, 0x36,0xf6,0x3e,0x36,0x36, 0xf6,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x3c,0x66,0x66, 0x06,0x06,0x06,0x66,0x66, 0x3c,0x18,0x30,0x1c,0x00,0x00}, 
	{0x18,0x00,0x7e,0x06,0x06, 0x06,0x3e,0x06,0x06,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x7e,0x06,0x06, 0x06,0x3e,0x06,0x06,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x66,0x00,0x7e,0x06,0x06, 0x06,0x3e,0x06,0x06,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x66,0x00,0x7e,0x06,0x06, 0x06,0x3e,0x06,0x06,0x06, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x18,0x00,0x3c,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x3c,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x66,0x00,0x3c,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x66,0x00,0x3c,0x18,0x18, 0x18,0x18,0x18,0x18,0x18, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x1e,0x36,0x66, 0x66,0x6f,0x66,0x66,0x36, 0x1e,0x00,0x00,0x00,0x00,0x00}, {0x76,0x00,0xc6,0xc6,0xce, 0xde,0xf6,0xe6,0xc6,0xc6, 0xc6,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x3c,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x3c,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x66,0x00,0x3c,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x76,0x00,0x3c,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x66,0x00,0x3c,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x42,0x66, 0x3c,0x18,0x3c,0x66,0x42, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x7c,0x66,0x76, 0x76,0x7e,0x6e,0x6e,0x66, 0x3e,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x66,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x66,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x66,0x00,0x66,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x66,0x00,0x66,0x66,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x18,0x00,0x66,0x66,0x66, 0x66,0x3c,0x18,0x18,0x18, 0x18,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x06,0x06,0x3e, 0x66,0x66,0x66,0x3e,0x06, 0x06,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x1c,0x36,0x36, 0x36,0x66,0x66,0x66,0x66, 0x36,0x00,0x00,0x00,0x00,0x00}, 
	{0x0e,0x0c,0x18,0x00,0x3c, 0x60,0x60,0x7c,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x70,0x30,0x18,0x00,0x3c, 0x60,0x60,0x7c,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x18,0x3c,0x66,0x00,0x3c, 0x60,0x60,0x7c,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x8e,0xdb,0x71,0x00,0x3c, 0x60,0x60,0x7c,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x66,0x66,0x00,0x3c, 0x60,0x60,0x7c,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x3c,0x66,0x3c,0x00,0x3c, 0x60,0x60,0x7c,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x76, 0xd8,0xd8,0xfe,0x1b,0x1b, 0xee,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x00,0x3c, 0x66,0x06,0x06,0x06,0x66, 0x3c,0x18,0x30,0x1c,0x00,0x00}, 
	{0x0e,0x0c,0x18,0x00,0x3c, 0x66,0x66,0x7e,0x06,0x06, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x70,0x30,0x18,0x00,0x3c, 0x66,0x66,0x7e,0x06,0x06, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x18,0x3c,0x66,0x00,0x3c, 0x66,0x66,0x7e,0x06,0x06, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x66,0x66,0x00,0x3c, 0x66,0x66,0x7e,0x06,0x06, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x0e,0x0c,0x18,0x00,0x1e, 0x18,0x18,0x18,0x18,0x18, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x70,0x30,0x18,0x00,0x1e, 0x18,0x18,0x18,0x18,0x18, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x18,0x3c,0x66,0x00,0x1e, 0x18,0x18,0x18,0x18,0x18, 0x7e,0x00,0x00,0x00,0x00,0x00}, {0x00,0x66,0x66,0x00,0x1e, 0x18,0x18,0x18,0x18,0x18, 0x7e,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x6c,0x18,0x36, 0x78,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x8e,0xdb,0x71,0x00,0x3e, 0x66,0x66,0x66,0x66,0x66, 0x66,0x00,0x00,0x00,0x00,0x00}, {0x0e,0x0c,0x18,0x00,0x3c, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x70,0x30,0x18,0x00,0x3c, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, 
	{0x18,0x3c,0x66,0x00,0x3c, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x8e,0xdb,0x71,0x00,0x3c, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x66,0x66,0x00,0x3c, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x00,0x00,0x00,0x00,0x00}, {0x00,0x00,0x00,0x18,0x18, 0x00,0x7e,0x00,0x18,0x18, 0x00,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x00,0x00,0x00,0x7c, 0x66,0x76,0x7e,0x6e,0x66, 0x3e,0x00,0x00,0x00,0x00,0x00}, {0x0e,0x0c,0x18,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x70,0x30,0x18,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x18,0x3c,0x66,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, 
	{0x00,0x66,0x66,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x7c,0x00,0x00,0x00,0x00,0x00}, {0x70,0x30,0x18,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x30,0x18,0x0f,0x00,0x00}, {0x00,0x00,0x06,0x06,0x06, 0x3e,0x66,0x66,0x66,0x66, 0x3e,0x06,0x06,0x06,0x00,0x00}, {0x00,0x66,0x66,0x00,0x66, 0x66,0x66,0x66,0x66,0x66, 0x3c,0x30,0x18,0x0f,0x00,0x00}
} ;

void FONT_FixedSysCorrect(unsigned char *FONT)
{
	unsigned int Counter,Counter2;
	Counter = 255;
	while (Counter > 32)
	{
		Counter2 = 15;
		while (Counter2--)
			FONT_FixedSys[Counter][Counter2 + 1] = FONT_FixedSys[Counter][Counter2];
		FONT_FixedSys[Counter][0] = FONT_FixedSys[Counter - 32][14];
		FONT_FixedSys[Counter][15] = 0;
		Counter--;
	}
	FONT_FixedSys[0][0] = 0;
}
unsigned char *GSP_GetCharPtr(unsigned char C)
{
	if (FONT_FixedSys[0][0] != 0) FONT_FixedSysCorrect((unsigned char *)FONT_FixedSys);
	return (unsigned char *)FONT_FixedSys + (((unsigned int)C) << 4);
}
#define BINK_SUB_PFORMAT u16
#define BINK_SUB_PFORMAT_BLENDER 0xfefe
#define BINK_SUB_PFORMAT_BLACK 0x8000
#define BINK_SUB_PFORMAT_WHITE 0x80ff
#define BS_GettOdd(a) a
#define BINK_SWAP(a,b) {BINK_SUB_PFORMAT SWP;SWP = a; a = b;b= SWP;};

#else // #if (defined _XBOX) || (defined _GAMECUBE)

#define BINK_SUB_PFORMAT u32
#define BINK_SUB_PFORMAT_BLENDER 0xfefefefe
extern unsigned char *GSP_GetCharPtr(unsigned char C);
#define BINK_SUB_PFORMAT_BLACK 0
#define BINK_SUB_PFORMAT_WHITE 0xffffff
#define BS_GettOdd(a) a
#define BINK_SWAP(a,b)

#endif
#ifdef PSX2_TARGET
register u_long128 BS_CDARK(register u_long128 Value,register u_long128 ValueAnd)
{
	register u_long128 LOCAL;
	asm _volatile_ 
	{
		.set noreorder
		pand Value,Value,ValueAnd
//		psrlw LOCAL,Value,3
		psrlw Value,Value,1
//		paddw Value,Value,LOCAL
		pref 0,0x40(a3)
		.set reorder
	}
	return Value;
}
#define TEX_SUB_DARKER_AND 0xfefefefe
void TEX_SUB_DARKER(u32 *Pos,u32 Lenght)
{
	u_long128 ValueAnd;
/*	while ((u32)Pos & 0xf)
	{
		*Pos &= TEX_SUB_DARKER_AND;
		*Pos >>= 1;
		Lenght--;
		Pos++;
	}*/
	((u32 *)&ValueAnd)[0] = TEX_SUB_DARKER_AND;
	((u32 *)&ValueAnd)[1] = TEX_SUB_DARKER_AND;
	((u32 *)&ValueAnd)[2] = TEX_SUB_DARKER_AND;
	((u32 *)&ValueAnd)[3] = TEX_SUB_DARKER_AND;
	Lenght>>= 2;
	while (Lenght--)
	{
		*(u_long128 *)Pos = BS_CDARK(*(u_long128 *)Pos,ValueAnd);
		Pos+=4;
	}
}
#endif


#ifdef _GAMECUBE
#define CHAR_W 13
#define CHAR_H 32
void BINK_DrawChar(BINK_SUB_PFORMAT *Coord,u32 X,u32 Y,u8 Char,u32 Color,u32 Pitch)
{
	char ETX[2];
	ETX[0] = Char;
	ETX[1] = 0;
	X = (u32) ((float)X * 512.0f / 640.0f);
	Y = SCREEN_HEIGHT - Y;
	GXI_DrawText(X,Y,ETX,Color,0,MAT_Cc_Op_Copy,MAT_Cc_Op_Add);
	
}
#else

u32 CHAR_W = 8;
u32 CHAR_H = 24;
void BINK_DrawChar_8(BINK_SUB_PFORMAT *Coord,u32 X,u32 Y,u8 Char,u32 Color,u32 Pitch)
{
	u8 *Cp,Value;
	BINK_SUB_PFORMAT *CoordSave,*CoordLast  ;
	u32 YCounter;
	BINK_SUB_PFORMAT Color2,Color_I,Color2_I;
	
	Color2_I = Color_I = BS_GettOdd(Color);
	Color2 = (Color & BINK_SUB_PFORMAT_BLENDER)>>1;
	Color2_I = (Color2_I & BINK_SUB_PFORMAT_BLENDER)>>1;
	
	Coord += X + Y*Pitch;

	if ((u32)Coord & 2) BINK_SWAP(Color,Color_I);
	if ((u32)Coord & 2) BINK_SWAP(Color2,Color2_I);

	Cp = GSP_GetCharPtr(Char);
	
	

	for (YCounter= 0 ; YCounter < 24;YCounter ++)
	{
		CoordSave = Coord;
		Value = Cp[(YCounter * 2 ) / 3];
		if (Value & 0x01) Coord[0] = Color;
		if (Value & 0x02) Coord[1] = Color_I;
		if (Value & 0x04) Coord[2] = Color;
		if (Value & 0x08) Coord[3] = Color_I;
		if (Value & 0x10) Coord[4] = Color;
		if (Value & 0x20) Coord[5] = Color_I;
		if (Value & 0x40) Coord[6] = Color;
		if (Value & 0x80) Coord[7] = Color_I;
		Value = Cp[((YCounter + 1) * 2 ) / 3];
		if (Value & 0x01) Coord[0] = ((Coord[0]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x02) Coord[1] = ((Coord[1]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x04) Coord[2] = ((Coord[2]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x08) Coord[3] = ((Coord[3]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x10) Coord[4] = ((Coord[4]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x20) Coord[5] = ((Coord[5]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x40) Coord[6] = ((Coord[6]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x80) Coord[7] = ((Coord[7]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;

		Coord = CoordSave + Pitch;
	}
}
/*
#define CHAR_W 12
#define CHAR_H 24*/
void BINK_DrawChar_12(BINK_SUB_PFORMAT *Coord,u32 X,u32 Y,u8 Char,u32 Color,u32 Pitch)
{
	u8 *Cp,Value;
	BINK_SUB_PFORMAT *CoordSave,*CoordLast  ;
	u32 YCounter;
	BINK_SUB_PFORMAT Color2,Color_I,Color2_I;
	
	Color2_I = Color_I = BS_GettOdd(Color);
	Color2 = (Color & BINK_SUB_PFORMAT_BLENDER)>>1;
	Color2_I = (Color2_I & BINK_SUB_PFORMAT_BLENDER)>>1;
	
	Coord += X + Y*Pitch;

	if ((u32)Coord & 2) BINK_SWAP(Color,Color_I);
	if ((u32)Coord & 2) BINK_SWAP(Color2,Color2_I);

	Cp = GSP_GetCharPtr(Char);
	
	

	for (YCounter= 0 ; YCounter < 24;YCounter ++)
	{
		CoordSave = Coord;
		Value = Cp[(YCounter * 2 ) / 3];
		if (Value & 0x01) Coord[0] = Color;
		if (Value & 0x01) Coord[1] = Color_I;
		if (Value & 0x02) Coord[2] = Color;
		if (Value & 0x04) Coord[3] = Color_I;
		if (Value & 0x04) Coord[4] = Color;
		if (Value & 0x08) Coord[5] = Color_I;
		if (Value & 0x10) Coord[6] = Color;
		if (Value & 0x10) Coord[7] = Color_I;
		if (Value & 0x20) Coord[8] = Color;
		if (Value & 0x40) Coord[9] = Color_I;
		if (Value & 0x40) Coord[10] = Color;
		if (Value & 0x80) Coord[11] = Color_I;
		Value = Cp[((YCounter + 1) * 2 ) / 3];
		if (Value & 0x01) Coord[0] = ((Coord[0]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x01) Coord[1] = ((Coord[1]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x02) Coord[2] = ((Coord[2]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x04) Coord[3] = ((Coord[3]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x04) Coord[4] = ((Coord[4]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x08) Coord[5] = ((Coord[5]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x10) Coord[6] = ((Coord[6]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x10) Coord[7] = ((Coord[7]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x20) Coord[8] = ((Coord[8]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x40) Coord[9] = ((Coord[9]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		if (Value & 0x40) Coord[10]= ((Coord[10] & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		if (Value & 0x80) Coord[11]= ((Coord[11] & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		
		Coord = CoordSave + Pitch;
	}
}
/*
#define CHAR_W 12
#define CHAR_H 32
*/
void BINK_DrawChar_12_32(BINK_SUB_PFORMAT *Coord,u32 X,u32 Y,u8 Char,u32 Color,u32 Pitch)
{
	u8 *Cp,Value;
	BINK_SUB_PFORMAT *CoordSave,*CoordLast  ;
	u32 YCounter;
	BINK_SUB_PFORMAT Color2,Color_I,Color2_I;

	Color2_I = Color_I = BS_GettOdd(Color);
	Color2 = (Color & BINK_SUB_PFORMAT_BLENDER)>>1;
	Color2_I = (Color2_I & BINK_SUB_PFORMAT_BLENDER)>>1;

	Coord += X + Y*Pitch;

	if ((u32)Coord & 2) BINK_SWAP(Color,Color_I);
	if ((u32)Coord & 2) BINK_SWAP(Color2,Color2_I);

	Cp = GSP_GetCharPtr(Char);

	for (YCounter= 0 ; YCounter < 32;YCounter ++)
	{
		CoordSave = Coord;
		Value = Cp[YCounter >> 1];
		if (Value & (0xf << 2))
		{
			if (Value & 0x04) Coord[3] = Color_I;
			if (Value & 0x04) Coord[4] = Color;
			if (Value & 0x08) Coord[5] = Color_I;
			if (Value & 0x10) Coord[6] = Color;
			if (Value & 0x10) Coord[7] = Color_I;
			if (Value & 0x20) Coord[8] = Color;
		}
		if (Value & 0xc3)
		{
			if (Value & 0x01) Coord[0] = Color;
			if (Value & 0x01) Coord[1] = Color_I;
			if (Value & 0x02) Coord[2] = Color;
			if (Value & 0x40) Coord[9] = Color_I;
			if (Value & 0x40) Coord[10] = Color;
			if (Value & 0x80) Coord[11] = Color_I;
		}
		Value = Cp[(YCounter >> 1) + 1];
		if (Value & (0xf << 2))
		{
			if (Value & 0x04) Coord[3] = ((Coord[3]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
			if (Value & 0x04) Coord[4] = ((Coord[4]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
			if (Value & 0x08) Coord[5] = ((Coord[5]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
			if (Value & 0x10) Coord[6] = ((Coord[6]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
			if (Value & 0x10) Coord[7] = ((Coord[7]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
			if (Value & 0x20) Coord[8] = ((Coord[8]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
		}
		if (Value & 0xc3)
		{
			if (Value & 0x02) Coord[2] = ((Coord[2]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
			if (Value & 0x01) Coord[0] = ((Coord[0]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
			if (Value & 0x01) Coord[1] = ((Coord[1]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
			if (Value & 0x40) Coord[9] = ((Coord[9]  & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
			if (Value & 0x40) Coord[10]= ((Coord[10] & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2;
			if (Value & 0x80) Coord[11]= ((Coord[11] & BINK_SUB_PFORMAT_BLENDER)>>1) + Color2_I;
		}
		
		Coord = CoordSave + Pitch;
	}
}
void BINK_DrawChar(BINK_SUB_PFORMAT *Coord,u32 X,u32 Y,u8 Char,u32 Color,u32 Pitch)
{
	if (CHAR_W <= 10)
		BINK_DrawChar_8(Coord,X,Y,Char,Color,Pitch);
	else
		BINK_DrawChar_12(Coord,X,Y,Char,Color,Pitch);
}
#endif

char *BINK_DrawSTRING(char *String,BINK_SUB_PFORMAT *TextAdress,u32 X , u32 Y ,u32 XSize,u32 Color)
{

	while (*String && (*String != 10))
	{
		BINK_DrawChar(TextAdress,X,Y,*String,Color,XSize);
		X += CHAR_W;
		String++;
	}
	return String;
}

char *BINK_GetNextSTRING(char *String)
{
	while (*String && (*String != 10))
	{
		String++;
	}
	return String;
}

u32 BINK_GetTextHeight(char *String)
{
	u32 Hight;
	Hight = 0;
	while (*String)
	{
		if (*String == 10) Hight++; 
		String++;
	}
	return Hight ;
}
u32 BINK_GetStringWidth(char *String)
{
	u32 Hight;
	Hight = 0;
	while (*String && (*String != 10))
	{
		Hight++;
		String++;
	}
	return Hight;
}
char *BINK_DrawString_Shadow(char *String,BINK_SUB_PFORMAT *Buffer,u32 XSize,u32 X ,u32 Y,BINK_SUB_PFORMAT Color)
{
#ifndef PSX2_TARGET
	BINK_DrawSTRING(String,Buffer , (X - 2) , (Y - 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X + 2) , (Y - 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X + 2) , (Y + 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X - 2) , (Y + 2) ,XSize,BINK_SUB_PFORMAT_BLACK);//*/
#endif	
#ifdef _GAMECUBE	
	BINK_DrawSTRING(String,Buffer , (X - 2) , (Y) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X + 2) , (Y) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X) , (Y + 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X) , (Y - 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
#endif	
	return BINK_DrawSTRING(String,Buffer , X , Y ,XSize,Color);
}

void BINK_DrawString_Demo(char *String,BINK_SUB_PFORMAT *Buffer,u32 XSize,u32 YSize)
{
	u32 X , Y;
	u32 ReYS;
	extern int AI_EvalFunc_VIEWSetMode_C( int i_Value );
	X = 20;
	Y = 0;
	ReYS = SCREEN_HEIGHT;
	if (AI_EvalFunc_VIEWSetMode_C(0) == 3) // 16 / 9
		ReYS = (u32)((float)SCREEN_HEIGHT * 0.75f);
	
	if (YSize > ReYS)
		Y = (YSize - ReYS) >> 1;
	Y += 5;

	BINK_DrawSTRING(String,Buffer , (X - 2) , (Y - 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X + 2) , (Y - 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X + 2) , (Y + 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , (X - 2) , (Y + 2) ,XSize,BINK_SUB_PFORMAT_BLACK);
	BINK_DrawSTRING(String,Buffer , X , Y ,XSize,0x80808080);
}

u32 BINK_LimitTEXT(char *String,char *DST,u32 XSizeMax,u32 *NumberOfCuts)
{
	u8 BOF;
	u32 Counter,NOL,TOTALLENGHT;
	char *LastGood;
	LastGood = &BOF;
	Counter = 0;
	NOL = 0;
	TOTALLENGHT = 0;
	while (*String)
	{
		Counter++;
		if ((Counter > XSizeMax) && (*NumberOfCuts))
		{
			*LastGood = 10;
			NOL++;
			Counter = 0;//DST - LastGood;
			(*NumberOfCuts) --;
		}
		if (*String == 10)
			Counter = 0;
		*DST = *String;
		if (*DST == ' ') 
			LastGood = DST;
		
		DST++;
		String++;
		TOTALLENGHT++;
	}
	*DST = *String;
	*NumberOfCuts = NOL;
	return TOTALLENGHT / (NOL + 1);
}
u32 BinkGetStringLenght(char *p)
{
	u32 REt;	
	REt = 0;
	while (*(p++)) 
	{
		REt++;
	}
	return REt;
}

void BINK_DrawTEXT_LIMIT(char *String,BINK_SUB_PFORMAT *Buffer,u32 XSize,u32 YSize,float PercentageOfPass,u32 VerticalLimit,BINK_SUB_PFORMAT Color)
{
	U32 X,Y;
	u32 TextHeight,Base;
	u32 ReYS;
	char *DSTString;
	char DSTString_COPY[2048];
	extern int AI_EvalFunc_VIEWSetMode_C( int i_Value );

	if (!VerticalLimit) VerticalLimit = 1;
	
	DSTString = DSTString_COPY;
	ReYS = 10000;
	TextHeight = BINK_LimitTEXT(String,DSTString,((XSize - (XSize >> 2)) / (CHAR_W)) - 4,&ReYS);
	BINK_LimitTEXT(String,DSTString,TextHeight + 2,&ReYS);
	
	Y = 0;
	ReYS = SCREEN_HEIGHT;
#ifndef _XBOX
	if (AI_EvalFunc_VIEWSetMode_C(0) == 3) // 16 / 9
		ReYS = (u32)((float)SCREEN_HEIGHT * 0.6f);
#endif
	
	if (YSize > ReYS)
		Y = (YSize - ReYS) >> 1;
	Y += 5;
	
	TextHeight = BINK_GetTextHeight(DSTString);
	
	Y = YSize - Y - CHAR_H - lMin(TextHeight,VerticalLimit - 1) * (CHAR_H + 4);
#ifdef PSX2_TARGET
	Y -= YSize>>1;
#endif
#ifdef _XBOX
	Y -= CHAR_W * 2;
#endif
/*	if (TextHeight + 1 > VerticalLimit)
		BINK_DrawSTRING("#",Buffer + (u32)((XSize - CHAR_W) * PercentageOfPass),XSize,BINK_SUB_PFORMAT_WHITE);	
*/	
	if (!*DSTString) return;
	Base = 0;
	while (PercentageOfPass  > (float)(Base + VerticalLimit) / (float)(TextHeight + 1))
	{
		u32 K;
		
		K = VerticalLimit;
		while (K--) 
		{
			DSTString = BINK_GetNextSTRING(DSTString);
			if (*DSTString) DSTString++;
			if (!*DSTString) return;
		}
		Base += VerticalLimit;
	}
	
	if (TextHeight + 1 > VerticalLimit)
	{
		TextHeight = lMin(BINK_GetTextHeight(DSTString) + 1,VerticalLimit);
		Y += (VerticalLimit - TextHeight) * (CHAR_H + 4);
	}
	
#ifdef PSX2_TARGET
	{
		u32 YStart;	
		YStart = ((Y - (CHAR_H>>2)) );
		TEX_SUB_DARKER(Buffer + YStart * XSize,XSize * ((YSize>>1) - YStart - 1));
	}
#endif	
	
	while (*DSTString)
	{
		DSTString = BINK_DrawString_Shadow(DSTString,Buffer,XSize,(XSize - (CHAR_W * BINK_GetStringWidth(DSTString)))>>1,Y,Color);
		if (*DSTString) DSTString++;
		Y += CHAR_H + 4;
		VerticalLimit--;
		if (!VerticalLimit) return;
	}
}

void BINK_DrawTEXT(char *String,u32 *Buffer,u32 XSize,u32 YSize)
{
	BINK_DrawTEXT_LIMIT(String,Buffer,XSize,YSize,0.0f,8,BINK_SUB_PFORMAT_WHITE);
}

char *LangRecover[] =
{
 /*French		*/"FR", /*English		*/"US", /*Danish		*/"DA", /*Dutch			*/"DU",
 /*Finnish		*/"FI", /*German		*/"GE", /*Italian		*/"IT", /*Spanish		*/"SP",
 /*Portuguese	*/"US", /*Swedish		*/"SW", /*Polish		*/"PO", /*Russian		*/"RU",
 /*Japanese		*/"US", /*Chinese		*/"US", /*Albanian		*/"US", /*Arabic		*/"US",
 /*Bulgarian	*/"US",	/*Byelorussian */ "US", /*Greek			*/"US",	/*Korean		*/"US",
 /*Norwegian	*/"NO",	 /*Romanian		*/"US", /*Serbian		*/"US", /*Slovak		*/"US",
 /*Slovenian	*/"US", /*Turkish		*/"US", /*Czech			*/"US", /*Hungarian		*/"US",
 /*Taiwanese	*/"US"
};
char *GetTimeString(char *File,char *TXTFileEnd)
{
	while (File < TXTFileEnd)
	{
		while (*File != 'L') 
		{
			File++;
		};
		if ((File[1] == 'A') &&
			(File[2] == 'N') &&
			(File[3] == 'G') &&
			(File[4] == '.'))
		{
			return &File[5];
		};
		File++;
	}
	return NULL;
}

char *SubtitleFile = NULL;
u32 SubtitleFileSize;

char *BS_GetNextLine(char *FT,char *TXTFileEnd)
{
	while (FT < TXTFileEnd)
	{
		if (*FT == 0) return FT + 2;
		FT++;
	}
	return NULL;
}
float BINK_ISOlder(HBINK bink,char *TimeCode)
{
	float TimeCode_InSeconds;
	if ((TimeCode[0] < '0') || (TimeCode[0] > '9'))
	{
		return 1000000.0f;//(float)bink->Frames/((float)bink->FrameRate/(float)bink->FrameRateDiv);
	}
	TimeCode_InSeconds =  (TimeCode[0] - '0') * 600.0f;
	TimeCode_InSeconds += (TimeCode[1] - '0') * 60.0f;
	TimeCode_InSeconds += (TimeCode[2] - '0') * 10.0f;
	TimeCode_InSeconds += (TimeCode[3] - '0');
	return TimeCode_InSeconds;
}


void BINK_DrawSUB(HBINK bink,u32 *Buffer,u32 XSize,u32 YSize)
{
	int Language;
	extern int  TEXT_gi_ChangedLang;
	extern int  AI_EvalFunc_IoConsLangGet_C(void);
	extern int  TEXT_i_GetLang(void);
	BOOL INO_b_LanguageIsPresent(int i);
	
	
#ifdef PSX2_TARGET
	extern int RUSSE_IS_SELECTED;
#else
	int RUSSE_IS_SELECTED ;
#endif

#ifndef _GAMECUBE
	/* Font Zoom selection */
	if (XSize > 600)
		CHAR_W = 12;
	else
		CHAR_W = 8;
#endif // _GAMECUBE
	


	if (bink->FrameNum > bink->Frames - 12) return;

    Language = (TEXT_gi_ChangedLang>1) ? TEXT_i_GetLang() : AI_EvalFunc_IoConsLangGet_C();
    if(!INO_b_LanguageIsPresent(Language)) Language = INO_e_English;
    
    RUSSE_IS_SELECTED = 0;
    if (Language == 11) RUSSE_IS_SELECTED = 1; // Russe
    if (Language == 10) RUSSE_IS_SELECTED = 2; // POlonais
    
	if (SubtitleFile)
	{
		char *Lang2Find,*TxtLocal,*TexToDraw;
		float CurrentTime, LastLineTime,CurrentLineTime;
		float MinimalTime;
		u32 TES;
		Lang2Find = LangRecover[Language];
		TxtLocal = SubtitleFile;
		while ((TxtLocal[0] != Lang2Find[0]) || (TxtLocal[1] != Lang2Find[1]))
		{
			TxtLocal = GetTimeString(TxtLocal,SubtitleFile + SubtitleFileSize);
			if (!TxtLocal) return;
		}
		TES = 0;
		/* Retreive timeCode */
		TxtLocal = BS_GetNextLine(TxtLocal,SubtitleFile + SubtitleFileSize);
		TexToDraw = TxtLocal;
		
		CurrentTime = (float)bink->FrameNum/((float)bink->FrameRate/(float)bink->FrameRateDiv);
		TxtLocal = BS_GetNextLine(TxtLocal,SubtitleFile + SubtitleFileSize);
		MinimalTime = 0;
		while (TxtLocal)
		{
			BINK_SUB_PFORMAT Color;
			float Late;
			CurrentLineTime = BINK_ISOlder(bink,TxtLocal);
			LastLineTime = BINK_ISOlder(bink,TexToDraw);

			Color = BINK_SUB_PFORMAT_WHITE;
			MinimalTime = lMax(LastLineTime,MinimalTime);
			Late = MinimalTime - LastLineTime;
//			if (Late) Color = 0x8080ff;
			LastLineTime += Late;
			MinimalTime += (float)BinkGetStringLenght(TexToDraw + 6) * 0.03f + 0.3f; // FASTER
			Late = lMax(CurrentLineTime,MinimalTime);
			Late = Late - CurrentLineTime;
//			if (Late) Color = 0x8080ff;
			CurrentLineTime += Late;

			Color = BINK_SUB_PFORMAT_WHITE;

			
//			*/

			if (CurrentLineTime > CurrentTime)
			{
				float LocalDelta,MaxTime;
				LocalDelta = CurrentTime - LastLineTime;
				MaxTime = (float)BinkGetStringLenght(TexToDraw + 6) * 0.08f + 0.5f; // CONFORT
				if (LocalDelta < MaxTime)
				{
					MaxTime  = lMin(MaxTime,(CurrentLineTime - LastLineTime));
					BINK_DrawTEXT_LIMIT(TexToDraw + 6,Buffer,XSize,YSize,(CurrentTime - LastLineTime) / MaxTime,2,Color);
				}
				RUSSE_IS_SELECTED = 0;
				return;
			}//*/
			TexToDraw = TxtLocal;
			TES++;
			TxtLocal = BS_GetNextLine(TxtLocal,SubtitleFile + SubtitleFileSize);
		}
	}//*/
	RUSSE_IS_SELECTED = 0;
}
void PreTreat(char *FT,u32 Size)
{
	while (Size--)
	{
		if (*FT == '\n') *FT = 0;
		if (*FT == '\r') *FT = 0;
		FT++;
	}
}
extern u32 IO_gi_SubtitleOn;
void BINK_SUBOpen(char *TXTFile)
{
#ifdef _XBOX	
	int ret;
#endif
	char SubName[1024];
	char *PDST;

	if (!TXTFile) return;
	
	if (!IO_gi_SubtitleOn)
	{
		extern int  TEXT_gi_ChangedLang;
		extern int  AI_EvalFunc_IoConsLangGet_C(void);
		extern int  TEXT_i_GetLang(void);
		BOOL INO_b_LanguageIsPresent(int i);
		int Language;
		char *TXTFileSave;
		TXTFileSave = TXTFile;
			
	    Language = (TEXT_gi_ChangedLang>1) ? TEXT_i_GetLang() : AI_EvalFunc_IoConsLangGet_C();
	    if(!INO_b_LanguageIsPresent(Language)) Language = INO_e_English;
	    
	    /*is it the NEWGAME.BIK */
		PDST = SubName;
		*(PDST ++) = 0;
		while (*TXTFileSave) *(PDST++) = *(TXTFileSave++);
		*(PDST) = 0;
		PDST--;
		while ((*PDST != '.') && *PDST) PDST--;
		if ((*PDST == '.') && (*(PDST - 1) == 'E') && (*(PDST - 2) == 'M') && (*(PDST - 3) == 'A')&& (*(PDST - 4) == 'G')) 
		{
		    /* => Voice are encoded for some language in NEWGAME.BIK */
		    switch (Language)
		    {
				case INO_e_English:	
				case INO_e_French:	
				case INO_e_Spanish:	
				case INO_e_German:	
				case INO_e_Italian:	;return;
		    }
		}

	    if (Language == INO_e_English) return;
	}
	
	PDST = SubName;
	*(PDST ++) = 0;
	while (*TXTFile) *(PDST++) = *(TXTFile++);
	*(PDST) = 0;
	PDST--;
	while ((*PDST != '.') && *PDST) PDST--;
	if (*PDST == '.')
	{
		s32		TXT_FILE;

		PDST[1] = 'T';
		PDST[2] = 'X';
		PDST[3] = 'T';
#ifdef PSX2_TARGET
		TXT_FILE = sceOpen(&SubName[1],SCE_RDONLY);
		if (TXT_FILE < 0) return;
		SubtitleFile = MEM_p_Alloc(100L * 1024L); // 100K Max;
		if (!SubtitleFile) return;
		SubtitleFileSize = sceRead(TXT_FILE , SubtitleFile ,100L * 1024L);
		sceClose(TXT_FILE);
#endif

#ifdef _XBOX
		//do
		//{
		TXT_FILE = fopen(&SubName[1],"rb");
		//if (!TXT_FILE) Gx8_FileError();
		//}
		//while(!TXT_FILE);
		if (TXT_FILE == 0) return;
		SubtitleFile = MEM_p_Alloc(100L * 1024L); // 100K Max;
		if (!SubtitleFile) return;

		fseek(TXT_FILE, 0, SEEK_END);
		SubtitleFileSize = ftell(TXT_FILE);
		fseek(TXT_FILE, 0, SEEK_SET);

		do {
				
				ret =fread(SubtitleFile ,1,SubtitleFileSize,TXT_FILE);
				if (!ret) Gx8_FileError(11);
		}while(!ret);
		fclose(TXT_FILE);
#endif

#ifdef _GAMECUBE
		{
			tdstGC_File *hSubFile = GC_fOpen(&SubName[1], NULL);
			if (hSubFile == NULL)
				return ;
				
		    SubtitleFileSize = OSRoundUp32B(DVDGetLength(&hSubFile->stFileInfo));
			SubtitleFile = MEM_p_AllocAlignMem(SubtitleFileSize,32,&MEM_gst_GCMemoryInfo);
			if (!SubtitleFile) 
				return;
		    
	    	GC_fRead(hSubFile,SubtitleFile,SubtitleFileSize);
			GC_fClose(hSubFile);
		}
#endif // _GAMECUBE

//		TSOPT = MEM_p_Alloc(sizeof(TEX_SUB_OPT) * 256);

		PreTreat(SubtitleFile,SubtitleFileSize);
	
	}
	else return;
}
void BINK_SUBClose()
{
	if (SubtitleFile != NULL) MEM_Free(SubtitleFile);
//	if (TSOPT != NULL) MEM_Free(TSOPT);
	SubtitleFile = NULL;
//	TSOPT = NULL;
}


/****************************************************************************************************************************/
/* Subtitle end *************************************************************************************************************/
/****************************************************************************************************************************/

